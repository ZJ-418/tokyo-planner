<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ±äº¬è–èª•è·¨å¹´ä¹‹æ—… 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #EBF5FB;
            -webkit-tap-highlight-color: transparent;
            color: #334155;
        }

        /* éš±è—æ²è»¸ */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Banner åœ“å¼§è¨­è¨ˆ */
        .header-curve {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background-color: #EBF5FB;
            border-top-left-radius: 40px;
            border-top-right-radius: 40px;
            z-index: 10;
        }

        /* Tab æŒ‰éˆ•æµ®å‹•æ•ˆæœ */
        .floating-tabs {
            position: absolute;
            bottom: 10px;
            right: 20px;
            z-index: 20;
            display: flex;
            gap: 10px;
        }

        .tab-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            color: #1E3A8A; /* æ·±è—è‰² */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            font-size: 1.2rem;
            border: 2px solid transparent;
        }

        .tab-btn.active {
            background: #1E3A8A;
            color: #FFF;
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(30, 58, 138, 0.3);
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card-shadow {
            box-shadow: 0 4px 20px rgba(179, 229, 252, 0.2);
        }

        /* å‹•ç•« */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tokyo-blue': '#1E3A8A',
                        'snow-white': '#F8FAFC',
                        'accent-gold': '#F59E0B',
                        'ice-blue': '#E0F2FE',
                    }
                }
            }
        }
    </script>
</head>
<body>

<div id="app" class="max-w-[480px] mx-auto min-h-screen bg-ice-blue/30 relative pb-24 bg-[#EBF5FB]">

    <header class="relative h-[250px] w-full overflow-hidden shadow-lg z-0">
        <img src="Image.jpg" alt="Tokyo Holiday" class="w-full h-full object-cover">
		<div class="absolute top-6 right-0 p-4 text-white text-right">
			<h1 class="text-2xl font-bold drop-shadow-lg pr-0">æ±äº¬è–èª•è·¨å¹´ä¹‹æ—…</h1>
			<p class="text-sm drop-shadow-md pr-4">2025/12/24 - 2026/01/03</p>
		</div>
        <div class="header-curve"></div>
        <div class="floating-tabs">
            <button @click="currentTab = 'itinerary'" :class="{'active': currentTab === 'itinerary'}" class="tab-btn">
                <i class="fa-solid fa-map-location-dot"></i>
            </button>
            <button @click="currentTab = 'info'" :class="{'active': currentTab === 'info'}" class="tab-btn">
                <i class="fa-solid fa-circle-info"></i>
            </button>
            <button @click="currentTab = 'shopping'" :class="{'active': currentTab === 'shopping'}" class="tab-btn">
                <i class="fa-solid fa-basket-shopping"></i>
            </button>
            <button @click="currentTab = 'expenses'" :class="{'active': currentTab === 'expenses'}" class="tab-btn">
                <i class="fa-solid fa-coins"></i>
            </button>
        </div>
    </header>

    <main class="relative z-10 px-4 -mt-2">

        <div v-if="currentTab === 'itinerary'" class="animate-fade-in">
            <div class="flex overflow-x-auto hide-scrollbar space-x-3 py-2 mb-4 snap-x">
                <div v-for="(day, index) in dates" :key="index"
                     @click="selectedDateIndex = index"
                     class="snap-center flex-shrink-0 w-[60px] h-[75px] rounded-2xl flex flex-col items-center justify-center cursor-pointer transition-all duration-300 border-2"
                     :class="selectedDateIndex === index ? 'bg-tokyo-blue text-white border-tokyo-blue shadow-lg scale-105' : 'bg-white text-slate-400 border-white'">
                    <span class="text-xs font-bold uppercase tracking-wider">{{ day.weekday }}</span>
                    <span class="text-xl font-bold">{{ day.date.split('/')[1] }}</span>
                </div>
            </div>

            <div class="bg-gradient-to-r from-blue-400 to-blue-300 rounded-3xl p-4 text-white shadow-lg mb-6 flex justify-between items-center relative overflow-hidden">
                <div class="relative z-10">
                    <div class="flex items-center space-x-3">
                        <i :class="weatherData.icon" class="text-4xl"></i>
                        <div>
                            <div class="text-3xl font-bold">{{ weatherData.temp }}Â°</div>
                            <div class="text-xs opacity-90">é«”æ„Ÿ {{ weatherData.feel }}Â°</div>
                        </div>
                    </div>
                </div>
                <div class="text-right relative z-10">
                    <div class="font-bold text-sm">æ±äº¬</div>
                    <div class="text-xs opacity-80">{{ dates[selectedDateIndex].date }}</div>
                </div>
                <div class="absolute -right-4 -bottom-4 w-20 h-20 bg-white opacity-20 rounded-full blur-xl"></div>
            </div>

            <div class="space-y-0 relative pb-20">
                <div v-if="currentItinerary.length === 0" class="text-center py-10 text-slate-400">
                    <i class="fa-solid fa-mug-hot text-4xl mb-2"></i>
                    <p>æœ¬æ—¥å°šç„¡è¡Œç¨‹</p>
                </div>

                <div v-for="(item, idx) in currentItinerary" :key="item.id" class="relative group pb-6">
                    <div v-if="idx > 0" class="absolute left-[24px] -top-3 w-0.5 h-6 bg-slate-300 z-0"></div>
                    <div v-if="idx > 0" class="flex items-center pl-10 text-xs text-slate-500 mb-2 relative z-10">
                        <i :class="getTransportIcon(item.transportType)" class="mr-1"></i>
                        <span>ç´„ {{ item.travelTime || '15 min' }}</span>
                    </div>
                    <div v-if="idx === 0" class="flex items-center pl-10 text-xs text-slate-500 mb-2">
                        <i class="fa-solid fa-hotel mr-1"></i>
                        <span>å¾é£¯åº—å‡ºç™¼</span>
                    </div>

                    <div class="flex relative">
                        <div class="flex flex-col items-center mr-3 min-w-[50px]">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center text-white shadow-md z-10 border-4 border-[#EBF5FB]" :class="getCategoryColor(item.category)">
                                <i :class="getCategoryIcon(item.category)"></i>
                            </div>
                            <div v-if="idx < currentItinerary.length - 1" class="w-0.5 h-full bg-slate-200 absolute top-12 left-[23px] -z-0"></div>
                        </div>

                        <div class="flex-1 bg-white rounded-2xl p-4 card-shadow border border-slate-100 relative overflow-hidden group">
                            <div v-if="item.category === 'flight'" class="bg-blue-50 -m-4 p-4 mb-0">
                                <div class="flex justify-between items-center text-tokyo-blue">
                                    <h3 class="font-bold text-lg"><i class="fa-solid fa-plane-up mr-2"></i>{{ item.name }}</h3>
                                </div>
                                <div class="mt-2 text-sm text-slate-600">{{ item.note }}</div>
                            </div>
                            <div v-else>
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-bold text-slate-800 text-lg leading-tight mb-1">{{ item.name }}</h3>
                                        <div class="flex items-center text-xs text-slate-500 font-bold mb-2">
                                            <span class="bg-slate-100 px-2 py-0.5 rounded mr-2" v-if="item.startTime">{{ item.startTime }}</span>
                                            <span v-if="item.price" class="text-accent-gold"><i class="fa-solid fa-ticket mr-1"></i>{{ item.price }}</span>
                                        </div>
                                    </div>
                                    <button @click.stop="openMap(item.name)" class="w-8 h-8 rounded-full bg-blue-50 text-tokyo-blue flex items-center justify-center hover:bg-tokyo-blue hover:text-white transition-colors">
                                        <i class="fa-solid fa-location-dot"></i>
                                    </button>
                                </div>
                                <div class="text-sm text-slate-500 space-y-1">
                                    <p v-if="item.hours"><i class="fa-regular fa-clock w-4 mr-1"></i> {{ item.hours }}</p>
                                    <p v-if="item.note" class="mt-2 text-xs bg-yellow-50 text-slate-600 p-2 rounded border border-yellow-100">
                                        <i class="fa-solid fa-quote-left text-yellow-400 mr-1"></i> {{ item.note }}
                                    </p>
                                </div>
                            </div>

                            <div class="flex justify-end mt-3 pt-2 border-t border-slate-100 space-x-2">
                                <button @click="moveItem(idx, -1)" v-if="idx > 0" class="text-xs bg-slate-100 p-1.5 rounded text-slate-500"><i class="fa-solid fa-arrow-up"></i></button>
                                <button @click="moveItem(idx, 1)" v-if="idx < currentItinerary.length - 1" class="text-xs bg-slate-100 p-1.5 rounded text-slate-500"><i class="fa-solid fa-arrow-down"></i></button>
                                <button @click="editItem(item)" class="text-xs bg-slate-100 px-3 py-1.5 rounded text-slate-600 font-bold hover:bg-slate-200">ç·¨è¼¯</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button @click="openAddModal" class="fixed bottom-6 right-6 w-14 h-14 bg-tokyo-blue text-white rounded-full shadow-xl flex items-center justify-center text-2xl z-50 hover:scale-110 transition-transform">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'info'" class="space-y-5 pb-20 animate-fade-in">
            <div class="bg-white rounded-3xl p-5 card-shadow">
                <h3 class="font-bold text-tokyo-blue mb-3 border-b pb-2"><i class="fa-solid fa-calculator mr-2"></i>åŒ¯ç‡æ›ç®— (0.20)</h3>
                <div class="flex items-center space-x-3">
                    <div class="flex-1">
                        <label class="text-xs text-slate-400">JPY</label>
                        <input type="number" v-model="currencyInput" @input="calculateCurrency" class="w-full bg-slate-50 rounded-xl p-2 font-bold text-lg border border-slate-200">
                    </div>
                    <i class="fa-solid fa-arrow-right-arrow-left text-slate-300 mt-4"></i>
                    <div class="flex-1">
                        <label class="text-xs text-slate-400">TWD</label>
                        <div class="w-full bg-blue-50 text-tokyo-blue rounded-xl p-2 font-bold text-lg border border-blue-100 text-right">$ {{ currencyResult }}</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-3xl p-5 card-shadow">
                <h3 class="font-bold text-tokyo-blue mb-3 border-b pb-2"><i class="fa-solid fa-plane mr-2"></i>èˆªç­è³‡è¨Š</h3>
                <div class="mb-4 relative pl-4 border-l-2 border-slate-200">
                    <div class="absolute -left-[5px] top-0 w-2.5 h-2.5 rounded-full bg-blue-500"></div>
                    <div class="flex justify-between text-sm font-bold"><span>å»ç¨‹ 12/24</span><span class="text-blue-600">CI0100</span></div>
                    <div class="mt-1 bg-slate-50 p-3 rounded-lg text-sm">
                        <div class="flex justify-between items-center">
                            <div><div class="text-2xl font-bold">09:30</div><div class="text-xs text-slate-500">TPE æ¡ƒåœ’</div></div>
                            <i class="fa-solid fa-plane text-slate-300 transform rotate-45"></i>
                            <div class="text-right"><div class="text-2xl font-bold">13:30</div><div class="text-xs text-slate-500">NRT æˆç”°</div></div>
                        </div>
                    </div>
                </div>
                <div class="relative pl-4 border-l-2 border-slate-200">
                    <div class="absolute -left-[5px] top-0 w-2.5 h-2.5 rounded-full bg-accent-gold"></div>
                    <div class="flex justify-between text-sm font-bold"><span>å›ç¨‹ 01/03</span><span class="text-blue-600">CI0101</span></div>
                    <div class="mt-1 bg-slate-50 p-3 rounded-lg text-sm">
                        <div class="flex justify-between items-center">
                            <div><div class="text-2xl font-bold">14:35</div><div class="text-xs text-slate-500">NRT æˆç”°</div></div>
                            <i class="fa-solid fa-plane text-slate-300 transform rotate-45"></i>
                            <div class="text-right"><div class="text-2xl font-bold">17:45</div><div class="text-xs text-slate-500">TPE æ¡ƒåœ’</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-3xl p-5 card-shadow">
                <h3 class="font-bold text-tokyo-blue mb-3 border-b pb-2"><i class="fa-solid fa-bed mr-2"></i>ä½å®¿è³‡è¨Š</h3>
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="font-bold text-lg">ç›¸éµFRESA INN æ±äº¬éŒ¦ç³¸ç”º</h4>
                        <p class="text-xs text-slate-500 mt-1">Sotetsu Fresa Inn Tokyo-Kinshicho</p>
                        <p class="text-sm mt-2"><i class="fa-solid fa-map-pin w-4 text-center mr-1 text-slate-400"></i> 2 Chome-18-7 Kotobashi</p>
                    </div>
                    <button @click="openMap('Sotetsu Fresa Inn Tokyo-Kinshicho')" class="w-10 h-10 bg-blue-100 rounded-full text-blue-600 flex items-center justify-center shadow-sm">
                        <i class="fa-solid fa-location-arrow"></i>
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <a href="tel:110" class="bg-red-50 border border-red-100 p-4 rounded-2xl flex flex-col items-center justify-center text-red-600 font-bold shadow-sm"><i class="fa-solid fa-user-shield text-2xl mb-2"></i>è­¦å¯Ÿ 110</a>
                <a href="tel:119" class="bg-red-50 border border-red-100 p-4 rounded-2xl flex flex-col items-center justify-center text-red-600 font-bold shadow-sm"><i class="fa-solid fa-truck-medical text-2xl mb-2"></i>æ•‘è­· 119</a>
             </div>
        </div>

        <div v-if="currentTab === 'shopping'" class="pb-20 animate-fade-in">
            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-2xl p-3 card-shadow relative group">
                    <div class="aspect-square bg-slate-100 rounded-xl mb-3 overflow-hidden border border-slate-100 relative">
                        <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex items-center justify-center text-slate-300"><i class="fa-solid fa-image text-3xl"></i></div>
                        <button @click="removeShoppingItem(idx)" class="absolute top-2 right-2 bg-black/50 text-white w-6 h-6 rounded-full text-xs flex items-center justify-center"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                    <p class="font-bold text-sm text-slate-800 text-center">{{ item.name }}</p>
                </div>
            </div>
            <button @click="showShoppingModal = true" class="fixed bottom-6 right-6 w-14 h-14 bg-tokyo-blue text-white rounded-full shadow-xl flex items-center justify-center text-2xl z-50 hover:scale-110 transition-transform"><i class="fa-solid fa-plus"></i></button>
        </div>

        <div v-if="currentTab === 'expenses'" class="pb-20 animate-fade-in">
            <div class="bg-gradient-to-r from-tokyo-blue to-blue-700 rounded-3xl p-6 text-white shadow-xl mb-6 relative overflow-hidden">
                <div class="relative z-10 text-center">
                    <p class="text-sm opacity-80 mb-1">ç›®å‰ç¸½èŠ±è²» (JPY)</p>
                    <h2 class="text-5xl font-bold tracking-tight">Â¥ {{ formatNumber(totalExpenses) }}</h2>
                </div>
                <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -mr-10 -mt-10"></div>
            </div>
            <div class="bg-white rounded-3xl p-5 card-shadow min-h-[300px]">
                <h3 class="font-bold text-slate-700 mb-4 flex items-center"><i class="fa-solid fa-list-ul mr-2"></i>æ”¯å‡ºç´€éŒ„</h3>
                <div class="space-y-4">
                    <div v-for="(exp, idx) in expenses" :key="idx" class="flex items-center justify-between border-b border-slate-50 pb-3 last:border-0">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-xs mr-3 shadow-sm" :class="getCategoryColor(exp.category)">{{ exp.category.substring(0,1) }}</div>
                            <div>
                                <p class="font-bold text-slate-800 text-sm">{{ exp.name }}</p>
                                <p class="text-xs text-slate-400">{{ exp.date }} Â· {{ exp.payment }}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-tokyo-blue">Â¥{{ formatNumber(exp.amount) }}</p>
                             <button @click="removeExpense(idx)" class="text-xs text-red-300 mt-1 block w-full text-right"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <button @click="showExpenseModal = true" class="fixed bottom-6 right-6 w-14 h-14 bg-tokyo-blue text-white rounded-full shadow-xl flex items-center justify-center text-2xl z-50 hover:scale-110 transition-transform"><i class="fa-solid fa-plus"></i></button>
        </div>
    </main>

    <div v-if="showItineraryModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
            <h3 class="font-bold text-xl mb-4 text-center text-tokyo-blue">{{ isEditMode ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h3>
            <div class="space-y-3">
                <select v-model="formItinerary.category" class="w-full bg-slate-50 rounded-xl p-3 border-none outline-none text-sm">
                    <option value="sightseeing">æ™¯é»</option>
                    <option value="food">ç¾é£Ÿ</option>
                    <option value="shopping">è³¼ç‰©</option>
                    <option value="accommodation">ä½å®¿</option>
                    <option value="transport">äº¤é€š</option>
                    <option value="flight">èˆªç­</option>
                    <option value="other">å…¶ä»–</option>
                </select>
                <input v-model="formItinerary.name" placeholder="è¡Œç¨‹åç¨±" class="w-full bg-slate-50 rounded-xl p-3 border-none outline-none text-sm">
                <div class="flex space-x-2">
                     <input v-model="formItinerary.startTime" placeholder="æ™‚é–“ (ä¾‹å¦‚ 15:00)" class="flex-1 bg-slate-50 rounded-xl p-3 border-none outline-none text-sm">
                     <input v-model="formItinerary.hours" placeholder="ç‡Ÿæ¥­æ™‚é–“" class="flex-1 bg-slate-50 rounded-xl p-3 border-none outline-none text-sm">
                </div>
                <input v-model="formItinerary.price" placeholder="é–€ç¥¨/è²»ç”¨" class="w-full bg-slate-50 rounded-xl p-3 border-none outline-none text-sm">
                <div class="text-xs text-slate-500 font-bold ml-1 mt-2">äº¤é€šæ–¹å¼ (è·ä¸‹ä¸€ç«™)</div>
                <div class="flex space-x-2">
                    <select v-model="formItinerary.transportType" class="flex-1 bg-slate-50 rounded-xl p-3 border-none outline-none text-sm">
                        <option value="walk">æ­¥è¡Œ</option>
                        <option value="car">é–‹è»Š</option>
                        <option value="public">å¤§çœ¾é‹è¼¸</option>
                    </select>
                    <input v-model="formItinerary.travelTime" placeholder="é ä¼°æ™‚é–“ (ä¾‹å¦‚ 15 min)" class="flex-1 bg-slate-50 rounded-xl p-3 border-none outline-none text-sm">
                </div>
                <textarea v-model="formItinerary.note" placeholder="å‚™è¨» / ç‰¹è‰²" rows="3" class="w-full bg-slate-50 rounded-xl p-3 border-none outline-none text-sm"></textarea>
            </div>
            <div class="flex space-x-3 mt-6">
                <button @click="showItineraryModal = false" class="flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-bold text-sm">å–æ¶ˆ</button>
                <button v-if="isEditMode" @click="deleteItineraryItem" class="w-12 bg-red-100 text-red-500 rounded-xl flex items-center justify-center"><i class="fa-solid fa-trash-can"></i></button>
                <button @click="saveItinerary" class="flex-1 py-3 bg-tokyo-blue text-white rounded-xl font-bold text-sm shadow-lg shadow-blue-900/20">ç¢ºèª</button>
            </div>
        </div>
    </div>

    <div v-if="showShoppingModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl">
            <h3 class="font-bold text-xl mb-4 text-center text-tokyo-blue">æ–°å¢è³¼ç‰©æ¸…å–®</h3>
            <input v-model="newShoppingItem.name" type="text" placeholder="å•†å“åç¨±" class="w-full bg-slate-50 rounded-xl p-3 mb-4 outline-none">
            <label class="block w-full h-32 border-2 border-dashed border-slate-300 rounded-xl flex flex-col items-center justify-center text-slate-400 cursor-pointer hover:bg-slate-50 transition-colors mb-6 overflow-hidden">
                <input type="file" @change="handleImageUpload" class="hidden" accept="image/*">
                <img v-if="newShoppingItem.image" :src="newShoppingItem.image" class="w-full h-full object-contain">
                <div v-else class="text-center"><i class="fa-solid fa-camera text-2xl mb-1"></i><span class="text-xs block">é»æ“Šä¸Šå‚³ç…§ç‰‡</span></div>
            </label>
            <div class="flex space-x-3">
                <button @click="showShoppingModal = false" class="flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-bold text-sm">å–æ¶ˆ</button>
                <button @click="addShoppingItem" class="flex-1 py-3 bg-tokyo-blue text-white rounded-xl font-bold text-sm shadow-lg">æ–°å¢</button>
            </div>
        </div>
    </div>

    <div v-if="showExpenseModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl">
            <h3 class="font-bold text-xl mb-4 text-center text-tokyo-blue">è¨˜ä¸€ç­†</h3>
            <div class="grid grid-cols-2 gap-3 mb-3">
                <select v-model="newExpense.category" class="bg-slate-50 rounded-xl p-3 text-sm outline-none">
                    <option value="food">é£²é£Ÿ</option>
                    <option value="shopping">è³¼ç‰©</option>
                    <option value="transport">äº¤é€š</option>
                    <option value="stay">ä½å®¿</option>
                    <option value="ticket">é–€ç¥¨</option>
                    <option value="other">å…¶ä»–</option>
                </select>
                <select v-model="newExpense.payment" class="bg-slate-50 rounded-xl p-3 text-sm outline-none"><option value="ç¾é‡‘">ç¾é‡‘</option><option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option></select>
            </div>
            <input v-model="newExpense.date" type="date" class="w-full bg-slate-50 rounded-xl p-3 mb-3 text-sm outline-none">
            <input v-model="newExpense.name" placeholder="åç¨±" class="w-full bg-slate-50 rounded-xl p-3 mb-3 text-sm outline-none">
            <div class="relative mb-6">
                <span class="absolute left-3 top-3 text-slate-400 font-bold">Â¥</span>
                <input v-model.number="newExpense.amount" type="number" placeholder="é‡‘é¡" class="w-full bg-slate-50 rounded-xl p-3 pl-8 font-bold text-lg outline-none">
            </div>
            <div class="flex space-x-3">
                <button @click="showExpenseModal = false" class="flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-bold text-sm">å–æ¶ˆ</button>
                <button @click="addExpense" class="flex-1 py-3 bg-tokyo-blue text-white rounded-xl font-bold text-sm shadow-lg">å„²å­˜</button>
            </div>
        </div>
    </div>

</div>

<script>
    // å¼•å…¥ watch å’Œ onMounted 
    const { createApp, ref, computed, watch, onMounted } = Vue

    createApp({
        setup() {
            const currentTab = ref('itinerary');
            const dates = ref([
                { date: '12/24', weekday: 'Wed' }, { date: '12/25', weekday: 'Thu' }, { date: '12/26', weekday: 'Fri' },
                { date: '12/27', weekday: 'Sat' }, { date: '12/28', weekday: 'Sun' }, { date: '12/29', weekday: 'Mon' },
                { date: '12/30', weekday: 'Tue' }, { date: '12/31', weekday: 'Wed' }, { date: '01/01', weekday: 'Thu' },
                { date: '01/02', weekday: 'Fri' }, { date: '01/03', weekday: 'Sat' },
            ]);
            const selectedDateIndex = ref(0);
            
            // é è¨­è¡Œç¨‹è³‡æ–™
            const defaultItinerary = {
                0: [
                    { id: 1, name: 'TPE æ¡ƒåœ’æ©Ÿå ´', category: 'flight', startTime: '09:30', note: 'CI0100 -> NRT 13:30', transportType: 'flight', travelTime: '4h' },
                    { id: 2, name: 'ç›¸éµFRESA INN æ±äº¬éŒ¦ç³¸ç”º', category: 'accommodation', startTime: '15:00', note: 'Check-in', transportType: 'public', travelTime: '1h' },
                    { id: 3, name: 'é«˜æœ¨ç¥ç¤¾â›©ï¸', category: 'sightseeing', startTime: '15:30', note: 'çµç·£ç¥ç¤¾', transportType: 'walk', travelTime: '' },
                    { id: 4, name: 'å¿—æ»¿è‰é¤…', category: 'food', startTime: '16:30', note: 'è‰¾è‰é»å¿ƒ', transportType: 'walk', travelTime: '' },
					{ id: 5, name: 'å‰å‚™å­å±‹', category: 'shopping', startTime: '16:30', note: 'æ¡ƒéˆ´', transportType: 'walk', travelTime: '' },
					{ id: 6, name: 'äº¬å³¶å—å…¬åœ’', category: 'sightseeing', startTime: '16:30', note: '', transportType: 'walk', travelTime: '' },
                    { id: 7, name: 'æ™´ç©ºå¡” æ•˜æ•˜è‹‘ (é ç´„)', category: 'food', startTime: '19:00', note: '30Fï¼Œå‚™æ¡ˆ:åˆ©ä¹…ç‰›èˆŒ 6Fã€å…­å˜èˆ30Fï¼Œäººå¤ªå¤šå¯ä»¥åƒ Tsuru TonTan åœ¨åä¸‰æ¨“ éºµåº—', transportType: 'walk', travelTime: '' },
					{ id: 8, name: 'æ™´ç©ºå¡”', category: 'sightseeing', startTime: '21:00', note: 'æ™´ç©ºå¡”è–èª•å¸‚é›†4Fæˆ¶å¤–ã€å¯¶å¯å¤¢ä¸­å¿ƒ 4Fã€äºŒæ¨“ä¼´æ‰‹ç¦®å€ 1/2500å¤§å°çš„æ™´ç©ºå¡” å‰æ‹¿æ£’', transportType: 'walk', travelTime: '' },
                    { id: 9, name: 'åé–“æ©‹', category: 'sightseeing', startTime: '22:00', note: 'æ‹æ”æ™´ç©ºå¡”å€’å½±', transportType: 'walk', travelTime: '' }
                ],
                1: [
                    { id: 201, name: 'ä¸Šé‡ä¹‹æ£®æ«»èŠ±è§€æ™¯å°ğŸ“·', category: 'sightseeing', startTime: '', note: 'ä¸Šé‡å…¬åœ’ã€ä¸Šé‡å¤§ä½›ã€æ±ç…§å®®ã€ä¸å¿æ± è¾¯å¤©å ‚ã€èŠ±åœ’ç¨»è·ç¥ç¤¾â›©', transportType: 'public', travelTime: '' },
                    { id: 202, name: 'é´¨toè”¥ / å±±å®¶ç‚¸è±¬æ’', category: 'food', startTime: '12:00', note: 'åˆé¤', transportType: 'walk', travelTime: '' },
                    { id: 203, name: 'Yamashiroya ç©å…·åº—', category: 'shopping', startTime: '13:30', note: 'ä¸Šé‡æœ€å¤§ç©å…·åº—', transportType: 'walk', travelTime: '' },
					{ id: 204, name: 'safnÂ° ã‚µãƒ•ãƒ³', category: 'food', startTime: '12:00', note: 'æŠ¹èŒ¶affogato å¸ƒä¸ã€ç¶“å…¸å¸ƒä¸', transportType: 'walk', travelTime: '' },
                    { id: 205, name: 'è°·ä¸­éŠ€åº§å•†åº—è¡—', category: 'sightseeing', startTime: '15:00', note: 'é™å®šç”œé» è’™å¸ƒæœ—ã€æ —å­å†°æ·‡æ·‹è›‹ç³•ã€å’Œæ —ã‚„(å’Œæ —ã‚„ å”¯ä¸€ç„¡äºŒã®å’Œæ —å°‚é–€åº—)ã€æ—¥æš®é‡Œå¤•é™½éšæ¢¯ï¼ˆæ—¥è½ æ—¥åŠ‡å–æ™¯é»ï¼‰', transportType: 'public', travelTime: '' },
                    { id: 206, name: 'ä»£ä»£æœ¨è–èª•å¸‚é›†', category: 'sightseeing', startTime: '17:30', note: 'è–èª•æ°›åœ', transportType: 'public', travelTime: '' },
                    { id: 207, name: 'å…­æœ¬æœ¨ å…¥é¹¿ToKyoæ‹‰éºµ', category: 'food', startTime: '19:30', note: 'ä¸‰è™Ÿå‡ºå£å‡ºä¾†ï¼Œå…­æœ¬æœ¨åå­—è·¯å£ã€€å‚™æ¡ˆ: æˆç€¨é°»é­šé£¯ï¼ˆæœ‰ä¸­æ–‡èœå–®ï¼‰ã€å…­æœ¬æœ¨ç«™çš„ãƒŸãƒ¼ãƒˆãƒãƒ³ è”¬èœè‚‰å·ä¸²', transportType: 'public', travelTime: '' },
                    { id: 208, name: 'å…­æœ¬æœ¨Hills è§€æ™¯å°', category: 'sightseeing', startTime: '21:00', note: '160å®¶åº—å¯ä»¥é€› 52æ¨“è§€æ™¯å°çœ‹å¤œæ™¯', transportType: 'walk', travelTime: '' },
					{ id: 209, name: 'å…­æœ¬æœ¨ Meat Man å±…é…’å±‹ğŸ®', category: 'food', startTime: '22:00', note: 'åº—å“¡æœ‰å°ç£äºº', transportType: 'walk', travelTime: '' }
                ],
                2: [
                    { id: 301, name: 'å‰å¾€éŒå€‰', category: 'transport', startTime: '09:00', note: 'JR æ¹˜å—æ–°å®¿ç·š æ± è¢‹ã€æ–°å®¿ã€æ¶‰è°· ï¼ˆæ­è¶…éå››ç«™ è¥¿å£è²·ä¸€æ—¥ç¥¨åˆ¸ï¼‰ä¸ç„¶è¥¿ç“œå¡å¯ä»¥ç›´æ¥ä¸Š', transportType: 'public', travelTime: '1h' },
                    { id: 302, name: 'é¶´å²¡å…«å¹¡å®® & å°ç”ºé€š', category: 'sightseeing', startTime: '10:30', note: 'ç‰›å…µè¡›å£½å¸ã€Giraffa curry panå’–å“©éºµåŒ…ã€éŒå€‰æ­¦å£«å ‚ï¼ˆæ‰­è›‹ï¼‰ã€é–‹é‹å¤§ä½›é›è›‹ç³•ã€é®ªãŠé‡ æ „ç”º é®å€‰å°ç”ºåº— é®ªé­šä¸¼é£¯ã€Long track Foods æ—¥ç³»é›œè²¨åº— é–€å£å†°æ«ƒæœ‰è‰è“é¦™è‰å†°æ·‡æ·‹ã€Re: Cha æº«é¦¨å°å’–å•¡å»³é©åˆæš´èµ°ä¸€æ³¢ä¼‘æ¯', transportType: 'walk', travelTime: '' },
                    { id: 303, name: 'éŒ¢æ´—å¼è²¡å¤©å®‡è³€ç¦ç¥ç¤¾â›©ï¸', category: 'sightseeing', startTime: '13:00', note: 'æ´—éŒ¢ç¥ç¤¾', transportType: 'walk', travelTime: '' },
					{ id: 304, name: 'éŒå€‰å¤§ä½›', category: 'sightseeing', startTime: '15:00', note: 'é€²å»è¦é–€ç¥¨ï¼Œå¯ä»¥è€ƒæ…®è·³é', transportType: 'public', travelTime: '' },
					{ id: 305, name: 'ä¸ƒé‡Œæ¿±', category: 'food', startTime: '15:00', note: 'Billsé¬†é¤…ã€EDW å’–å“©é£¯', transportType: 'public', travelTime: '' },
                    { id: 306, name: 'éŒå€‰é«˜æ ¡å‰', category: 'sightseeing', startTime: '15:00', note: 'çŒç±ƒé«˜æ‰‹å¹³äº¤é“', transportType: 'public', travelTime: '' },
                    { id: 307, name: 'æ±Ÿä¹‹å³¶', category: 'sightseeing', startTime: '16:30', note: 'KAMOKOTO Kitchen è»Šç«™æ—çš„æ—¥å¼å®šé£Ÿï¼ˆå”æšé›ã€èŒ¶æ³¡é£¯ï¼‰ã€ç´€ã®åœ‹å±‹æœ¬åº— æ‹›ç‰Œè“å­ æ¯”è¼ƒæ¨è–¦å†°æ·‡æ·‹', transportType: 'walk', travelTime: '' }
                ],
                3: [
                    { id: 401, name: 'æ·ºè‰ä»ŠåŠ', category: 'food', startTime: '10:30', note: 'å£½å–œç‡’åˆé–“å¥—é¤æ’éšŠ(11:30é–‹é–€ï¼Œå»ºè­°10:30å»æ’éšŠç¬¬ä¸€çµ„)ï¼Œå‚™æ¡ˆï¼š æ·ºè‰ é›·é–€ æ«»ç”° è€å¥¶å¥¶ è€åº—ï¼ˆåˆé–“å¥—é¤åªæœ‰ä¸€ç¨® $1500æ—¥å¹£ å£½å–œç‡’ï¼‰', transportType: 'public', travelTime: '' },
                    { id: 402, name: 'é›·é–€ & æ·ºè‰å¯º', category: 'sightseeing', startTime: '12:00', note: 'è€å¥¶å¥¶æ¡ƒéˆ´ã€æ­£æ®¿å·¦é‚Š ã€Œå½±å‘å ‚ã€ ä»£è³¼æ¶ç¿»çš„å¤§é»‘å¤©å¾¡å®ˆã€ä¸‰éº—é·—åº—', transportType: 'walk', travelTime: '' },
					{ id: 403, name: 'FUGLEN TOKYO', category: 'food', startTime: '13:30', note: 'åŒ—æ­æŒªå¨å† è»å’–å•¡', transportType: 'walk', travelTime: '' },
					{ id: 404, name: 'Ginza brazil', category: 'food', startTime: '13:30', note: 'èµ·å£«åå¸ã€è±¬æ’ä¸‰æ˜æ²»', transportType: 'walk', travelTime: '' },
                    { id: 405, name: 'åˆç¾½æ©‹é“å…·è¡—', category: 'shopping', startTime: '13:30', note: 'æ´‹è“å­ãƒ¬ãƒ¢ãƒ³ãƒ‘ã‚¤ æª¸æª¬æ´¾ ï¼ˆ12é»é–‹åº—å°±ä¾†è²·ï¼‰', transportType: 'walk', travelTime: '' },
                    { id: 406, name: 'éŒ¦ç³¸ç”º é˜¿å¡å°‡/ç™¾è²¨', category: 'shopping', startTime: '15:00', note: 'é ‚æ¨“æ‹æ™´ç©ºå¡”ï¼Œå‚™é¸ï¼šç¶²æ•·å¤©ç¥ç¤¾å¾¡æ—…æ‰€ ï¼ˆå“¥å‰æ‹‰ç¥ç¤¾â›©ï¸ï¼‰åªæœ‰é€±æœ«ä¸‹åˆæœ‰è³£å¾¡å®ˆ', transportType: 'walk', travelTime: '' },
					{ id: 407, name: 'æ¼¢å ¡ç‹ éŒ¦ç³¸ç”ºåŒ—å£åº—', category: 'sightseeing', startTime: '15:00', note: 'å·¨å¤§æ™´ç©ºå¡”æ‹ç…§é»', transportType: 'walk', travelTime: '' },
                    { id: 408, name: 'æ ¹ä¸¸èŠ±å¼å£½å¸ğŸ£', category: 'food', startTime: '18:00', note: 'æ™šé¤', transportType: 'walk', travelTime: '' },
                    { id: 409, name: 'å°å ´æµ·æ¿±å…¬åœ’', category: 'sightseeing', startTime: '19:00', note: 'å½©è™¹ç…™ç«(5åˆ†é˜)', transportType: 'public', travelTime: '' }
                ],
                4: [
                    { id: 501, name: 'äººå½¢ç”º unison taylor', category: 'food', startTime: '10:00', note: 'æ—©é¤ï¼Œè¶…å¥½åƒæ³•å¼åå¸', transportType: 'public', travelTime: '' },
					{ id: 502, name: 'éº»å¸ƒå° teamLab', category: 'sightseeing', startTime: '11:30', note: 'å·²é è¨‚', transportType: 'public', travelTime: '' },
					{ id: 503, name: 'éº»å¸ƒå°ä¹‹ä¸˜ Hills Commeâ€™n Tokyo', category: 'food', startTime: '11:30', note: 'ä¸–ç•Œæ’åç¬¬ä¸€çš„éºµåŒ…åº—ğŸ', transportType: 'public', travelTime: '' },
                    { id: 504, name: 'æ¾€è°· Parco æ¥µå‘³å±‹', category: 'food', startTime: '15:30', note: 'B1 æ¼¢å ¡æ’', transportType: 'public', travelTime: '' },
					{ id: 505, name: 'æ¾€è°· parco', category: 'shopping', startTime: '15:30', note: 'å¯ä»¥ç¨å¾®é€› jump shop è·ŸPUEBCO ã€ä»»å¤©å ‚ï¼Œæ¾€è°· é“ç„å‚é€šå•†å ´ã€Dondon donki çš„æƒ…ç†±åƒ¹æ ¼ï¼Œæ¾€è°· Kenyanç´…èŒ¶ å¥¶èŒ¶ï¼ˆå†°ã€ç†±éƒ½å¥½å–ï¼‰ï¼Œæ–œå°é¢ è—ç“¶å’–å•¡ï¼ˆä¼´æ‰‹ç¦®ï¼‰ï¼Œæ¾€è°· Freakâ€™s storeï¼Œæ¾€è°·ãƒŠã‚¿ãƒ»ãƒ‡ãƒ»ã‚¯ãƒªã‚¹ãƒã‚¢ãƒ éš±è—ç‰ˆè›‹å¡”åº— é’ä¹‹æ´çªŸè·¯ä¸Šæœƒç¶“é ğŸ®', transportType: 'public', travelTime: '' },
                    { id: 506, name: 'æ˜æ²»ç¥å®® & åŸå®¿', category: 'sightseeing', startTime: '17:00', note: 'Kiddy Land, è²“è¡— ï¼ˆç¶“éKIDDY LAND å¾å··å­é€²å»ï¼‰å¯ä»¥é€›åˆ°æ¾€è°·ï¼Œã€Œç¬‘ãŸã“ åŸå®¿è¡¨å‚é“åº—ã€ç¬‘è‡‰ç« é­šç‡’ æ•£æ­¥ç¾é£Ÿ', transportType: 'walk', travelTime: '' },
                    { id: 507, name: 'è¡¨åƒé“', category: 'shopping', startTime: '19:00', note: 'è¡¨åƒé“gelato pique cafe bio concept å¯éº—é¤…åº—ï¼ŒGraniph tokyo åŸå‰µIPé™é‡æœé£¾å“ç‰Œï¼Œï¼ˆäºŒæ¨“æœ‰éº»å¸ƒåç•ªä¾†çš„ç”œç”œåœˆå¯ä»¥ä¼‘æ¯ï¼‰ï¼Œã‚·ã‚¢ã‚¿ãƒ¼ãƒ—ãƒ­ãƒ€ã‚¯ãƒ„ å¥³ç”ŸåŒ…åŒ…ï¼ŒFlying tiger ç”Ÿæ´»é›œè²¨', transportType: 'walk', travelTime: '' },
					{ id: 508, name: 'æ¾€è°·SKY æ—¥è½ ğŸŒŸ', category: 'sightseeing', startTime: '19:00', note: 'å¾…é å®š é è¨ˆè¨‚19:00å·¦å³', transportType: 'walk', travelTime: '' },
                    { id: 509, name: 'TsuruTonTan UDON NOODLE Brasserie æ¸‹è°·', category: 'food', startTime: '20:30', note: 'æ¾€è°·æ™šé¤ï¼Œ13æ¨“ å‰µæ„çƒé¾éºµ', transportType: 'walk', travelTime: '' }
                ],
                5: [],
                6: [
                   { id: 701, name: 'ç¯‰åœ°å¸‚å ´', category: 'food', startTime: '09:00', note: 'Tonboya èœ» çƒ¤é®ªé­šä¸²ã€ä¸¸è±é£¯ç³°ã€Matcha stand Maruni Tokyoï¼ˆæŠ¹èŒ¶å¯ä»¥é¸æ¿ƒåº¦ ï¼‰ã€ç±³æœ¬å’–å•¡â˜•ï¸ï¼ˆé»‘ç³–èœœå’–å•¡ï¼‰', transportType: 'public', travelTime: '' },
                   { id: 702, name: 'éŠ€åº§ é‡‘é­šå±• (é ç´„)', category: 'sightseeing', startTime: '13:30', note: 'å·²é è¨‚ã€ä¸‰è¶Šç™¾è²¨é ‚æ¨“ åœ°è—å°Š', transportType: 'public', travelTime: '' },
                   { id: 703, name: 'éŠ€åº§ å±±ç¬‘ å£½å–œç‡’', category: 'food', startTime: '14:30', note: 'æœ‰é»å°è²´ é©åˆåƒåˆé–“å¥—é¤', transportType: 'walk', travelTime: '' },
                   { id: 704, name: 'éŠ€åº§é€›è¡— / ç§‹è‘‰åŸ', category: 'shopping', startTime: '16:00', note: '1.bic camera 2.ä¸‰è¶Šã€æ¾å±‹ ï¼ˆå‚³çµ±ååº—ï¼‰3.éŠ€åº§ loft ï¼ˆé›œè²¨å¤©å ‚ï¼‰4.OIOIã€Lumine ï¼ˆæ—¥ç³»å¹³åƒ¹ç™¾è²¨ï¼‰5.Tokyu Plaza ï¼ˆè¨­è¨ˆæ„Ÿå¤–è§€ï¼‰6.ltoya ï¼ˆ12å±¤æ–‡å…·è–åœ°ï¼‰7.é³©å±…å ‚ ï¼ˆç™¾å¹´å’Œç´™æ–‡å…·ï¼‰8.Sanrioworld + TOY PARK å¡é€šIPã€ç§‹è‘‰å…ƒè»Šç«™ç‰›å¥¶ğŸ¥›ã€ç§‹è‘‰åŸ æ”¶éŸ³æ©Ÿæœƒé¤¨', transportType: 'public', travelTime: '' },
                   { id: 705, name: 'ç¥ç”°ç¥ç¤¾', category: 'sightseeing', startTime: '18:00', note: 'ITå¾¡å®ˆã€ç”Ÿæ„èˆˆéš†', transportType: 'walk', travelTime: '' },
                   { id: 706, name: 'ç§‹è‘‰åŸ ç‰›æ’ä¸€äºŒä¸‰', category: 'food', startTime: '19:30', note: 'æ™šé¤', transportType: 'walk', travelTime: '' },
				   { id: 707, name: 'æ±äº¬éµå¡”', category: 'sightseeing', startTime: '18:00', note: 'æ±äº¬éµå¡”å¤œæ™¯ğŸ‘', transportType: 'walk', travelTime: '' }
                ],
                7: [
                   { id: 801, name: 'å“ˆåˆ©æ³¢ç‰¹å½±åŸ (é ç´„)', category: 'sightseeing', startTime: '13:00', note: 'å“ˆåˆ©æ³¢ç‰¹åœ’å€ 9:30é–‹åœ’ è²·10:00çš„ç¥¨ ææ—©9:30åˆ°è²·å‘¨é‚Š é è¨ˆèŠ±è²» 4å°æ™‚ï¼Œé–€ç¥¨ğŸ« æˆäºº 6300æ—¥å¹£  ğŸ§¹äº¤é€šæ–¹å¼ æ±äº¬ç·´é¦¬åŸå€å…¬åœ’ï¼ˆåŸæœ¬çš„è±å³¶åœ’ï¼‰æ–°å®¿æ²¢ â¡ï¸ åœ°éµ â¡ï¸ å¤§æ±Ÿæˆ¶ç·š â¡ï¸ è±å³¶åœ’æ²¢  âš ï¸è¨˜å¾—å…ˆä¸Šå»æ‰€ å»æ‰€åœ¨å¾ˆè£¡é¢', transportType: 'public', travelTime: '' },
                   { id: 802, name: 'è·¨å¹´è•éº¥éºµ', category: 'food', startTime: '20:00', note: 'å¾…å®š', transportType: 'public', travelTime: '' }
                ],
                8: [
                   { id: 901, name: 'æ¾€è°· ç”°åœ’éƒ½å¸‚ç·š ã€‹ä¸‰è»’èŒ¶å±‹', category: 'sightseeing', startTime: '10:00', note: 'ä¸‰è»’èŒ¶å±‹å¤§çŒ©çŒ© https://maps.app.goo.gl/AqHSUUr1hENXQSn3A?g_st=ipc ã€ç‰¹è‰²éºµåŒ…åº— å¾©å¤ç©å…· https://maps.app.goo.gl/xd9NanuWdPbqRoXA9?g_st=ipc ã€ç”œç”œåœˆã€æ¼¢å ¡ã€å“ˆå¯†ç“œè˜‡æ‰“ï¼Œè½‰æ­è·¯é¢é›»è»ŠğŸš‹ï¼ˆä¸–ç”°è°·ç·šï¼‰ ã€‰ å®®ã®å‚é§… æœ‰æ©Ÿæœƒæ­åˆ°æ‹›è²¡è²“é›»è»Š æ‹›è²¡è²“åˆ—è»Šæ™‚åˆ»è¡¨ é‹è¡Œæ™‚åˆ»è¡¨ï¼ˆå¹¸ç¦ã®æ‹›ãçŒ«é›»è»Šï¼‰ï½œæ±æ€¥ãƒ»æ±æ€¥é›»é‰„å…¬å¼ã‚µã‚¤ãƒˆ', transportType: 'public', travelTime: '' }
                ],
                9: [
                   { id: 1001, name: 'æ± è¢‹ç™¾è²¨', category: 'shopping', startTime: '11:00', note: 'é€›è¡—', transportType: 'public', travelTime: '' },
                   { id: 1002, name: 'å¤šæ‘©å·æ·ºé–“ç¥ç¤¾â›©ï¸', category: 'sightseeing', startTime: '15:00', note: 'å“¥å‰æ‹‰ç¥ç¤¾', transportType: 'public', travelTime: '' }
                ],
                10: [
                   { id: 1101, name: 'é€€æˆ¿ / æ—©é¤', category: 'accommodation', startTime: '09:00', note: 'ç›¸éµé£¯åº—é€€æˆ¿', transportType: 'walk', travelTime: '0' },
                   { id: 1102, name: 'å‰å¾€æˆç”°æ©Ÿå ´', category: 'transport', startTime: '10:30', note: 'é è¨ˆæ­ä¹˜ N\'EX æˆ–å·´å£«', transportType: 'public', travelTime: '1h 20m' },
                   { id: 1103, name: 'NRT æˆç”°æ©Ÿå ´', category: 'flight', startTime: '14:35', note: 'CI0101 -> TPE', transportType: 'flight', travelTime: '0' }
                ]
            };

            const itineraryData = ref(defaultItinerary);
            const shoppingList = ref([]);
            const expenses = ref([
                { name: 'æ©Ÿç¥¨', category: 'transport', amount: 19236, date: '2025-08-06', payment: 'ä¿¡ç”¨å¡' }
            ]);

            // å®šç¾© LocalStorage çš„ Keyï¼Œé¿å…è¡çª
            const STORAGE_KEYS = {
                ITINERARY: 'tokyo_trip_itinerary',
                SHOPPING: 'tokyo_trip_shopping',
                EXPENSES: 'tokyo_trip_expenses'
            };

            // 1. åœ¨ onMounted éšæ®µè¼‰å…¥è³‡æ–™ 
            onMounted(() => {
                const savedItinerary = localStorage.getItem(STORAGE_KEYS.ITINERARY);
                if (savedItinerary) {
                    // å¦‚æœæœ‰å­˜éï¼Œå°±è®€å–
                    itineraryData.value = JSON.parse(savedItinerary);
                } else {
                    // å¦‚æœæ²’æœ‰ï¼Œå°±ç”¨é è¨­å€¼ (itineraryData é è¨­å·²ç¶“æ˜¯ defaultItineraryï¼Œæ‰€ä»¥é€™è£¡ä¸ç”¨ç‰¹åˆ¥åšäº‹ï¼Œæˆ–è€…å†æ¬¡ç¢ºèª)
                    itineraryData.value = defaultItinerary;
                }

                const savedShopping = localStorage.getItem(STORAGE_KEYS.SHOPPING);
                if (savedShopping) {
                    shoppingList.value = JSON.parse(savedShopping);
                }

                const savedExpenses = localStorage.getItem(STORAGE_KEYS.EXPENSES);
                if (savedExpenses) {
                    expenses.value = JSON.parse(savedExpenses);
                }
            });

            // 2. ä½¿ç”¨ watch ç›£è½è³‡æ–™è®Šå‹•ï¼Œä¸¦è‡ªå‹•ä¿å­˜ 
            // { deep: true } å¾ˆé‡è¦ï¼Œå› ç‚ºæˆ‘å€‘è¦ç›£è½ç‰©ä»¶/é™£åˆ—å…§éƒ¨çš„è®ŠåŒ–
            watch(itineraryData, (newVal) => {
                localStorage.setItem(STORAGE_KEYS.ITINERARY, JSON.stringify(newVal));
            }, { deep: true });

            watch(shoppingList, (newVal) => {
                localStorage.setItem(STORAGE_KEYS.SHOPPING, JSON.stringify(newVal));
            }, { deep: true });

            watch(expenses, (newVal) => {
                localStorage.setItem(STORAGE_KEYS.EXPENSES, JSON.stringify(newVal));
            }, { deep: true });

            const currentItinerary = computed(() => {
                if(!itineraryData.value[selectedDateIndex.value]) return [];
                return itineraryData.value[selectedDateIndex.value];
            });

            const weatherData = computed(() => {
                const isSnow = selectedDateIndex.value % 3 === 0; 
                return {
                    icon: isSnow ? 'fa-regular fa-snowflake' : 'fa-regular fa-sun',
                    temp: isSnow ? '2' : '8',
                    feel: isSnow ? '-1' : '5'
                }
            });

            const currencyInput = ref(1000);
            const currencyResult = ref(200);
            const calculateCurrency = () => {
                currencyResult.value = Math.round(currencyInput.value * 0.20);
            };

            const showItineraryModal = ref(false);
            const showShoppingModal = ref(false);
            const showExpenseModal = ref(false);
            const isEditMode = ref(false);
            const formItinerary = ref({});
            const newShoppingItem = ref({ name: '', image: null });
            const newExpense = ref({ category: 'food', payment: 'ç¾é‡‘', date: '2025-12-24' });

            const getCategoryColor = (cat) => {
                const map = {
                    sightseeing: 'bg-red-400', food: 'bg-orange-400', shopping: 'bg-blue-400',
                    accommodation: 'bg-indigo-500', transport: 'bg-slate-500', flight: 'bg-sky-500', other: 'bg-gray-400'
                };
                return map[cat] || 'bg-gray-400';
            };
            const getCategoryIcon = (cat) => {
                const map = {
                    sightseeing: 'fa-solid fa-camera', food: 'fa-solid fa-utensils', shopping: 'fa-solid fa-bag-shopping',
                    accommodation: 'fa-solid fa-bed', transport: 'fa-solid fa-train', flight: 'fa-solid fa-plane', other: 'fa-solid fa-star'
                };
                return map[cat] || 'fa-solid fa-star';
            };
            const getTransportIcon = (type) => {
                return type === 'car' ? 'fa-solid fa-car' : (type === 'walk' ? 'fa-solid fa-person-walking' : 'fa-solid fa-train-subway');
            };

            const openMap = (query) => {
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank');
            };

            const openAddModal = () => {
                isEditMode.value = false;
                formItinerary.value = { category: 'sightseeing', transportType: 'walk', travelTime: '15 min' };
                showItineraryModal.value = true;
            };

            const editItem = (item) => {
                isEditMode.value = true;
                formItinerary.value = { ...item };
                showItineraryModal.value = true;
            };

            const saveItinerary = () => {
                const list = itineraryData.value[selectedDateIndex.value] || [];
                if (isEditMode.value) {
                    const idx = list.findIndex(i => i.id === formItinerary.value.id);
                    if (idx !== -1) list[idx] = { ...formItinerary.value };
                } else {
                    if (!itineraryData.value[selectedDateIndex.value]) itineraryData.value[selectedDateIndex.value] = [];
                    itineraryData.value[selectedDateIndex.value].push({ ...formItinerary.value, id: Date.now() });
                }
                showItineraryModal.value = false;
            };

            const deleteItineraryItem = () => {
                if(confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿ')) {
                    const list = itineraryData.value[selectedDateIndex.value];
                    const idx = list.findIndex(i => i.id === formItinerary.value.id);
                    if (idx !== -1) list.splice(idx, 1);
                    showItineraryModal.value = false;
                }
            };

            const moveItem = (index, direction) => {
                const list = itineraryData.value[selectedDateIndex.value];
                const temp = list[index];
                list[index] = list[index + direction];
                list[index + direction] = temp;
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => newShoppingItem.value.image = e.target.result;
                reader.readAsDataURL(file);
            };
            const addShoppingItem = () => {
                if(!newShoppingItem.value.name) return;
                shoppingList.value.push({ ...newShoppingItem.value });
                newShoppingItem.value = { name: '', image: null };
                showShoppingModal.value = false;
            };
            const removeShoppingItem = (idx) => shoppingList.value.splice(idx, 1);

            const addExpense = () => {
                if(!newExpense.value.amount) return;
                expenses.value.unshift({ ...newExpense.value });
                showExpenseModal.value = false;
                newExpense.value = { category: 'food', payment: 'ç¾é‡‘', date: '2025-12-24', name: '' };
            };
            const removeExpense = (idx) => {
                if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) expenses.value.splice(idx, 1);
            };
            const totalExpenses = computed(() => expenses.value.reduce((sum, item) => sum + item.amount, 0));
            const formatNumber = (num) => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            return {
                currentTab, dates, selectedDateIndex, weatherData,
                itineraryData, currentItinerary, shoppingList, expenses,
                currencyInput, currencyResult, calculateCurrency,
                showItineraryModal, showShoppingModal, showExpenseModal, isEditMode,
                formItinerary, newShoppingItem, newExpense,
                getCategoryColor, getCategoryIcon, getTransportIcon,
                openMap, openAddModal, editItem, saveItinerary, deleteItineraryItem, moveItem,
                handleImageUpload, addShoppingItem, removeShoppingItem,
                addExpense, removeExpense, totalExpenses, formatNumber
            }
        }
    }).mount('#app')
</script>
</body>
</html>