<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ±äº¬å†¬æ—¥ä¹‹æ—… 2025-2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'snow-white': '#F0FFFF',        // é›ªç™½è‰²/æ¥µæ·ºè—
                        'ice-blue': '#B3E5FC',          // å†°å·è— (å¼·èª¿è‰²)
                        'light-snow-blue': '#E5F3F7',   // æ•´å€‹é é¢æŸ”å’Œæ·ºè—åº•è‰²
                        'deep-sea-blue': '#01579B',     // æ·±æµ·è— (æ–‡å­—/å¼·èª¿/ä¸»è¦ICON)
                        'accent-yellow': '#FFD54F',     // æº«æš–é»ƒ (æŒ‰éˆ•/é»ç¶´)
                        'soft-gray': '#F5F5F5',         // èƒŒæ™¯ç°
                        'category-green': '#A5D6A7',    // æ™¯é»ç¶ 
                        'category-orange': '#FFCC80',   // ç¾é£Ÿæ©˜
                        'category-red': '#EF9A9A',      // ä½å®¿ç´…
                        'category-purple': '#CE93D8',   // è³¼ç‰©ç´«
                        'category-blue': '#81D4FA',     // èˆªç­è—
                        'category-gray': '#B0BEC5'      // å…¶ä»–ç°
                    }
                }
            }
        }
    </script>
    
    <style>
        /* é é¢èƒŒæ™¯è‰²å’Œå­—é«” */
        body {
            background-color: #E5F3F7; /* light-snow-blue */
            font-family: 'Noto Sans TC', sans-serif;
        }

        /* éš±è—æ»¾å‹•æ¢ - ä¿æŒ App ç¾æ„Ÿ */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* åœ“è§’æ¼¸è®Šæ•ˆæœ */
        .rounded-banner-bottom {
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-xl relative">

    <div class="h-[250px] overflow-hidden relative rounded-banner-bottom">
        <img src="Image.jpg" class="w-full h-full object-cover" alt="Banner Image: Family Trip to Hokkaido">
        <div class="absolute inset-0 bg-deep-sea-blue bg-opacity-10"></div>
        
        <div class="absolute top-8 left-0 p-4 text-white">
            <h1 class="text-3xl font-bold drop-shadow-lg">æ±äº¬å†¬æ—¥ä¹‹æ—…</h1>
            <p class="text-sm drop-shadow-md">2025/12/24 - 2026/01/03</p>
        </div>
    </div>

    <main class="relative z-10 -mt-8 p-4 bg-white rounded-t-[40px] min-h-[calc(100vh-250px+8px)]">
        
        <div v-show="currentTab === 'itinerary'">
            <div class="pt-4">
                <h2 class="text-2xl font-semibold text-deep-sea-blue mb-4">ğŸ—“ï¸ æ¯æ—¥è¡Œç¨‹</h2>
            </div>
            
            <div class="flex overflow-x-auto hide-scrollbar mb-4 space-x-2 pb-2 sticky top-0 z-20 bg-white rounded-xl shadow-sm">
                <button
                    v-for="(date, index) in dates"
                    :key="index"
                    @click="selectedDateIndex = index"
                    :class="[
                        'flex flex-col items-center justify-center p-3 rounded-xl transition-colors min-w-[70px]',
                        selectedDateIndex === index ? 'bg-ice-blue text-deep-sea-blue shadow-md' : 'bg-soft-gray text-gray-600 hover:bg-ice-blue/50'
                    ]"
                >
                    <span class="text-sm font-bold">{{ date.dayOfWeek }}</span>
                    <span class="text-xl font-extrabold">{{ date.dayOfMonth }}</span>
                </button>
            </div>
            
            <div class="space-y-4">
                
                <div v-if="currentItinerary.length > 0 && selectedDateIndex === 0" class="flex items-center justify-between p-4 bg-light-snow-blue rounded-xl shadow-inner mb-4">
                    <div class="flex items-center space-x-3">
                        <i :class="getWeatherIcon(weatherData.icon)" class="text-3xl text-deep-sea-blue"></i>
                        <div>
                            <p class="font-bold text-gray-700">{{ getWeatherDescription(weatherData.icon) }}</p>
                            <p class="text-sm text-gray-500">é«”æ„Ÿ {{ weatherData.feelsLike }}Â°C</p>
                        </div>
                    </div>
                    <div class="text-2xl font-extrabold text-deep-sea-blue">{{ weatherData.temp }}Â°C</div>
                </div>

                <div v-if="currentItinerary.length === 0" class="text-center text-gray-500 py-10 border border-dashed rounded-lg">
                    æœ¬æ—¥ç„¡è¡Œç¨‹ï¼Œé»æ“Šå³ä¸‹è§’ <i class="fa-solid fa-plus"></i> æ–°å¢ã€‚
                </div>

                <div v-for="(item, index) in currentItinerary" :key="item.id">
                    
                    <div v-if="index > 0 || selectedDateIndex > 0" class="flex items-center justify-center space-x-2 py-2 text-deep-sea-blue/70">
                        <i :class="getTransportIcon(item.transport.type)" class="text-xl"></i>
                        <span class="font-medium text-sm">{{ item.transport.time }}</span>
                    </div>

                    <div
                        @click="editItem('itinerary', index)"
                        class="bg-white p-4 rounded-xl shadow-lg border-l-4 transition-all duration-300 hover:shadow-xl cursor-pointer relative"
                        :style="{ 'border-left-color': getCategoryColor(item.category) }"
                    >
                        <div class="absolute top-[-10px] right-3 bg-white px-2 py-0.5 rounded-full text-xs font-bold shadow"
                             :style="{ 'color': getCategoryColor(item.category), 'border': '1px solid ' + getCategoryColor(item.category) }">
                            <i :class="getCategoryIcon(item.category)" class="mr-1"></i>
                            {{ getCategoryLabel(item.category) }}
                        </div>
                        
                        <div v-if="item.category === 'èˆªç­'" class="text-center p-3">
                             <h3 class="text-xl font-bold text-deep-sea-blue mb-2">âœˆï¸ {{ item.name }}</h3>
                             <div class="flex justify-around text-sm text-gray-600">
                                <div><i class="fa-solid fa-plane-departure mr-1"></i> {{ item.departureTime }}</div>
                                <div><i class="fa-solid fa-plane-arrival mr-1"></i> {{ item.arrivalTime }}</div>
                             </div>
                             <p class="text-xs text-gray-500 mt-1">èˆªç­ç·¨è™Ÿ: {{ item.flightNumber }}</p>
                        </div>

                        <div v-else>
                            <h3 class="text-lg font-bold text-gray-800 mb-1">{{ item.name }}</h3>
                            <div class="text-sm text-gray-600 space-y-1">
                                <p v-if="item.time"><i class="fa-regular fa-clock w-4 mr-1"></i> {{ item.time }}</p>
                                <p v-if="item.ticket && item.category === 'æ™¯é»'"><i class="fa-solid fa-ticket w-4 mr-1"></i> é–€ç¥¨: {{ formatNumber(item.ticket) }} JPY</p>
                                <p v-if="item.notes" class="text-xs text-gray-500 break-all"><i class="fa-solid fa-circle-info w-4 mr-1"></i> {{ item.notes.substring(0, 50) }}...</p>
                            </div>
                        </div>

                        <div class="flex justify-end space-x-3 mt-3 border-t pt-2">
                            <button @click.stop="openMap(item.name, item.address)" class="text-sm text-ice-blue hover:text-deep-sea-blue transition-colors">
                                <i class="fa-solid fa-location-dot"></i> åœ°åœ–
                            </button>
                            <button @click.stop="openMapDirections(item.name, item.address)" class="text-sm text-deep-sea-blue hover:text-ice-blue transition-colors">
                                <i class="fa-solid fa-route"></i> å°èˆª
                            </button>
                        </div>
                        
                        <div class="absolute top-4 right-4 flex flex-col space-y-1" v-if="item.category !== 'èˆªç­'">
                            <button @click.stop="moveItineraryUp(index)" :disabled="index === 0" class="text-xs p-1 rounded-full bg-soft-gray/70 text-deep-sea-blue disabled:opacity-30">
                                <i class="fa-solid fa-caret-up"></i>
                            </button>
                            <button @click.stop="moveItineraryDown(index)" :disabled="index === currentItinerary.length - 1" class="text-xs p-1 rounded-full bg-soft-gray/70 text-deep-sea-blue disabled:opacity-30">
                                <i class="fa-solid fa-caret-down"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="h-16"></div> </div>
            
        </div>
        
        <div v-show="currentTab === 'info'" class="pt-4">
            <h2 class="text-2xl font-semibold text-deep-sea-blue mb-4">â„¹ï¸ è³‡è¨Š</h2>

            <div class="bg-light-snow-blue p-4 rounded-xl shadow-md mb-6">
                <h3 class="text-xl font-bold text-deep-sea-blue mb-3 border-b pb-2">ğŸ’° åŒ¯ç‡æ›ç®— (JPY â†’ TWD)</h3>
                <div class="flex space-x-3 items-center">
                    <input type="number" v-model="currencyInput" @input="calculateCurrency" placeholder="è¼¸å…¥ JPY é‡‘é¡" class="flex-grow p-2 rounded-lg border focus:border-ice-blue focus:ring-ice-blue">
                    <i class="fa-solid fa-right-long text-xl text-deep-sea-blue"></i>
                </div>
                <p class="mt-3 text-lg font-bold text-gray-700">ç´„ç­‰æ–¼: <span class="text-deep-sea-blue">{{ formatNumber(currencyResult) }}</span> TWD</p>
                <p class="text-xs text-gray-500 mt-1">æ¨¡æ“¬åŒ¯ç‡: 1 JPY â‰ˆ 0.22 TWD</p>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-md mb-6 border-l-4 border-category-blue">
                <h3 class="text-xl font-bold text-deep-sea-blue mb-3 border-b pb-2">âœˆï¸ èˆªç­è³‡è¨Š</h3>
                <div v-for="(flight, index) in flights" :key="index" class="mb-3 p-3 bg-soft-gray rounded-lg">
                    <p class="text-sm font-semibold text-gray-700 mb-1">{{ flight.type }}ç¨‹</p>
                    <div class="flex justify-between items-center text-deep-sea-blue font-extrabold mb-1">
                        <span>{{ flight.originAirport }}</span>
                        <i class="fa-solid fa-plane text-xl mx-2"></i>
                        <span>{{ flight.destinationAirport }}</span>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500">
                        <span>{{ flight.departureTime }}</span>
                        <span>{{ flight.arrivalTime }}</span>
                    </div>
                    <p class="text-xs mt-2 text-gray-600">èˆªç­ç·¨è™Ÿ: **{{ flight.flightNumber }}** / é£›è¡Œæ™‚é–“: {{ flight.duration }}</p>
                </div>
            </div>
            
            <div class="bg-white p-4 rounded-xl shadow-md mb-6 border-l-4 border-category-red">
                <h3 class="text-xl font-bold text-deep-sea-blue mb-3 border-b pb-2">ğŸ¨ ä½å®¿è³‡è¨Š</h3>
                <p class="font-bold text-gray-800">{{ hotels.name }}</p>
                <p class="text-sm text-gray-600"><i class="fa-solid fa-phone mr-1"></i> {{ hotels.phone }}</p>
                <p class="text-sm text-gray-600 mb-2"><i class="fa-solid fa-location-dot mr-1"></i> {{ hotels.address }}</p>
                <button @click="openMapDirections(hotels.name, hotels.address)" class="text-sm text-ice-blue hover:text-deep-sea-blue transition-colors font-medium">
                    <i class="fa-solid fa-route mr-1"></i> å°èˆªè‡³é£¯åº—
                </button>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-md mb-6 border-l-4 border-accent-yellow">
                <h3 class="text-xl font-bold text-deep-sea-blue mb-3 border-b pb-2">ğŸš¨ ç·Šæ€¥è¯çµ¡é›»è©±</h3>
                <p class="text-sm text-gray-600"><i class="fa-solid fa-user-doctor mr-2"></i> æ•‘è­·è»Š/ç«è­¦: **119**</p>
                <p class="text-sm text-gray-600"><i class="fa-solid fa-handcuffs mr-2"></i> è­¦å¯Ÿ: **110**</p>
                <p class="text-xs text-gray-500 mt-2">è«‹åœ¨ç·Šæ€¥æƒ…æ³ä¸‹ä½¿ç”¨ï¼Œä¸¦æä¾›æ‚¨æ‰€åœ¨çš„ç²¾ç¢ºåœ°å€ã€‚</p>
            </div>
            
        </div>
        
        <div v-show="currentTab === 'shopping'" class="pt-4">
            <h2 class="text-2xl font-semibold text-deep-sea-blue mb-4">ğŸ›ï¸ è³¼ç‰©æ¸…å–® ({{ shoppingList.filter(i => !i.bought).length }} é …æœªè³¼)</h2>
            <div class="space-y-3">
                <div v-if="shoppingList.length === 0" class="text-center text-gray-500 py-10 border border-dashed rounded-lg">
                    è³¼ç‰©æ¸…å–®ç©ºç©ºå¦‚ä¹Ÿï¼Œé»æ“Šå³ä¸‹è§’ <i class="fa-solid fa-plus"></i> æ–°å¢ã€‚
                </div>

                <div v-for="(item, index) in shoppingList" :key="index" class="flex items-center bg-white p-3 rounded-xl shadow-md transition-shadow hover:shadow-lg">
                    
                    <input type="checkbox" v-model="item.bought" class="w-5 h-5 text-deep-sea-blue border-gray-300 rounded focus:ring-deep-sea-blue mr-3">
                    
                    <div class="flex-grow">
                        <p :class="['font-semibold', item.bought ? 'line-through text-gray-400' : 'text-gray-800']">{{ item.name }}</p>
                        <p v-if="item.notes" class="text-xs text-gray-500 break-all">{{ item.notes }}</p>
                    </div>

                    <div v-if="item.imageUrl" class="ml-3 w-10 h-10 overflow-hidden rounded-md border">
                        <img :src="item.imageUrl" alt="å•†å“åœ–ç‰‡" class="w-full h-full object-cover">
                    </div>

                    <button @click="removeShoppingItem(index)" class="ml-4 text-gray-400 hover:text-red-500 transition-colors">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="h-16"></div>
        </div>
        
        <div v-show="currentTab === 'expenses'" class="pt-4">
            <h2 class="text-2xl font-semibold text-deep-sea-blue mb-4">ğŸ’µ èŠ±è²»ç´€éŒ„</h2>
            
            <div class="bg-ice-blue/30 p-4 rounded-xl shadow-md mb-6">
                <h3 class="text-xl font-bold text-deep-sea-blue mb-2">ç¸½èŠ±è²»æ¦‚æ³</h3>
                <div class="flex justify-between items-center border-b border-deep-sea-blue/20 pb-1 mb-1">
                    <p class="text-sm text-gray-700">æ—¥å¹£ç¸½è¨ˆ (JPY)</p>
                    <p class="text-lg font-extrabold text-deep-sea-blue">{{ formatNumber(totalExpensesJPY) }}</p>
                </div>
                <div class="flex justify-between items-center">
                    <p class="text-sm text-gray-700">å°å¹£ç¸½è¨ˆ (TWD)</p>
                    <p class="text-lg font-extrabold text-deep-sea-blue">{{ formatNumber(totalExpensesTWD) }}</p>
                </div>
                <p class="text-xs text-gray-500 mt-2">ï¼ˆTWD ä¾æ¨¡æ“¬åŒ¯ç‡ 0.22 è¨ˆç®—ï¼‰</p>
            </div>

            <div class="space-y-3">
                 <div v-if="expenses.length === 0" class="text-center text-gray-500 py-10 border border-dashed rounded-lg">
                    é‚„æ²’æœ‰ä»»ä½•èŠ±è²»ï¼Œé»æ“Šå³ä¸‹è§’ <i class="fa-solid fa-plus"></i> æ–°å¢ã€‚
                </div>

                <div v-for="(expense, index) in expenses" :key="index" class="bg-white p-4 rounded-xl shadow-md border-l-4 border-category-purple flex justify-between items-center transition-shadow hover:shadow-lg">
                    <div>
                        <p class="font-bold text-gray-800">{{ expense.name }}</p>
                        <div class="text-sm text-gray-500 mt-1 space-x-2">
                            <span><i class="fa-solid fa-tag"></i> {{ getCategoryLabel(expense.category) }}</span>
                            <span><i class="fa-solid fa-calendar"></i> {{ expense.date }}</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1 break-all">{{ expense.notes.substring(0, 30) }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-extrabold text-red-600">{{ formatNumber(expense.amount) }} JPY</p>
                        <p class="text-xs text-gray-600"><i :class="expense.paymentMethod === 'ç¾é‡‘' ? 'fa-solid fa-money-bill' : 'fa-solid fa-credit-card'"></i> {{ expense.paymentMethod }}</p>
                    </div>
                    <button @click="removeExpense(index)" class="ml-4 text-gray-400 hover:text-red-500 transition-colors">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="h-16"></div>
        </div>
        
    </main>

    <div class="fixed bottom-0 w-full max-w-md mx-auto bg-white border-t border-gray-100 shadow-2xl p-2 rounded-t-2xl z-50">
        <div class="flex justify-around">
            <button @click="currentTab = 'itinerary'" class="flex flex-col items-center p-2 rounded-lg transition-colors"
                    :class="currentTab === 'itinerary' ? 'text-deep-sea-blue font-bold' : 'text-gray-400 hover:text-deep-sea-blue/80'">
                <i class="fa-solid fa-map-location-dot text-xl"></i>
                <span class="text-xs mt-1">è¡Œç¨‹</span>
            </button>
            <button @click="currentTab = 'info'" class="flex flex-col items-center p-2 rounded-lg transition-colors"
                    :class="currentTab === 'info' ? 'text-deep-sea-blue font-bold' : 'text-gray-400 hover:text-deep-sea-blue/80'">
                <i class="fa-solid fa-circle-info text-xl"></i>
                <span class="text-xs mt-1">è³‡è¨Š</span>
            </button>
            <button @click="currentTab = 'shopping'" class="flex flex-col items-center p-2 rounded-lg transition-colors"
                    :class="currentTab === 'shopping' ? 'text-deep-sea-blue font-bold' : 'text-gray-400 hover:text-deep-sea-blue/80'">
                <i class="fa-solid fa-basket-shopping text-xl"></i>
                <span class="text-xs mt-1">è³¼ç‰©</span>
            </button>
            <button @click="currentTab = 'expenses'" class="flex flex-col items-center p-2 rounded-lg transition-colors"
                    :class="currentTab === 'expenses' ? 'text-deep-sea-blue font-bold' : 'text-gray-400 hover:text-deep-sea-blue/80'">
                <i class="fa-solid fa-money-bill-wave text-xl"></i>
                <span class="text-xs mt-1">èŠ±è²»</span>
            </button>
        </div>
    </div>
    
    <button @click="handleAddClick" v-if="currentTab !== 'info'"
        class="fixed bottom-16 right-6 bg-accent-yellow text-deep-sea-blue w-14 h-14 rounded-full shadow-2xl transition-transform duration-300 hover:scale-105 z-50">
        <i class="fa-solid fa-plus text-2xl"></i>
    </button>


    <div v-show="showItineraryModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end justify-center">
        <div class="bg-white w-full max-w-md p-6 rounded-t-3xl shadow-2xl transform transition-transform duration-300 translate-y-0">
            <h3 class="text-2xl font-bold text-deep-sea-blue mb-4">{{ isEditMode ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h3>
            <form @submit.prevent="saveItineraryItem" class="space-y-4">
                <div class="flex space-x-3">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700">åç¨±</label>
                        <input type="text" v-model="newItinerary.name" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:border-ice-blue focus:ring-ice-blue">
                    </div>
                    <div class="w-1/3">
                        <label class="block text-sm font-medium text-gray-700">é¡åˆ¥</label>
                        <select v-model="newItinerary.category" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:border-ice-blue focus:ring-ice-blue bg-white">
                            <option value="æ™¯é»">æ™¯é»</option>
                            <option value="ä½å®¿">ä½å®¿</option>
                            <option value="ç¾é£Ÿ">ç¾é£Ÿ</option>
                            <option value="è³¼ç‰©">è³¼ç‰©</option>
                            <option value="èˆªç­" v-if="selectedDateIndex === 0 && currentItinerary.length === 0">èˆªç­</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                </div>
                
                <div v-if="newItinerary.category !== 'èˆªç­'" class="flex space-x-3">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700">ç‡Ÿæ¥­/é–‹æ”¾æ™‚é–“</label>
                        <input type="text" v-model="newItinerary.time" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="w-1/3" v-if="newItinerary.category === 'æ™¯é»'">
                        <label class="block text-sm font-medium text-gray-700">é–€ç¥¨ (JPY)</label>
                        <input type="number" v-model.number="newItinerary.ticket" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                </div>

                <div v-if="newItinerary.category === 'èˆªç­'">
                    <label class="block text-sm font-medium text-gray-700">èˆªç­ç·¨è™Ÿ</label>
                    <input type="text" v-model="newItinerary.flightNumber" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    <div class="flex space-x-3 mt-3">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700">èµ·é£›æ™‚é–“</label>
                            <input type="text" v-model="newItinerary.departureTime" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700">æŠµé”æ™‚é–“</label>
                            <input type="text" v-model="newItinerary.arrivalTime" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">åœ°å€ (Google Mapç”¨)</label>
                    <input type="text" v-model="newItinerary.address" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">ç‰¹è‰² & å‚™è¨»</label>
                    <textarea v-model="newItinerary.notes" rows="3" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg"></textarea>
                </div>
                
                <div class="flex justify-between pt-4">
                    <button type="button" @click="showItineraryModal = false; isEditMode = false;" class="px-4 py-2 text-deep-sea-blue border border-deep-sea-blue rounded-lg hover:bg-soft-gray transition-colors">å–æ¶ˆ</button>
                    <div class="flex space-x-3">
                        <button type="button" v-if="isEditMode" @click="removeItineraryItem" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">åˆªé™¤</button>
                        <button type="submit" class="px-6 py-2 bg-deep-sea-blue text-white rounded-lg hover:bg-ice-blue hover:text-deep-sea-blue transition-colors">{{ isEditMode ? 'å„²å­˜è®Šæ›´' : 'æ–°å¢' }}</button>
                    </div>
                </div>
            </form>
        </div>
    </div>


    <div v-show="showShoppingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end justify-center">
        <div class="bg-white w-full max-w-md p-6 rounded-t-3xl shadow-2xl">
            <h3 class="text-2xl font-bold text-deep-sea-blue mb-4">æ–°å¢è³¼ç‰©é …ç›®</h3>
            <form @submit.prevent="addShoppingItem" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">å•†å“åç¨±</label>
                    <input type="text" v-model="newShoppingItem.name" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">å‚™è¨»/åœ¨å“ªè£¡è²· (é¸å¡«)</label>
                    <input type="text" v-model="newShoppingItem.notes" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">åœ–ç‰‡ä¸Šå‚³ (æ‰‹æ©Ÿåœ–ç‰‡)</label>
                    <input type="file" @change="handleImageUpload" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-ice-blue file:text-deep-sea-blue hover:file:bg-ice-blue/70">
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" @click="showShoppingModal = false" class="px-4 py-2 text-deep-sea-blue border border-deep-sea-blue rounded-lg hover:bg-soft-gray transition-colors">å–æ¶ˆ</button>
                    <button type="submit" class="px-6 py-2 bg-deep-sea-blue text-white rounded-lg hover:bg-ice-blue hover:text-deep-sea-blue transition-colors">æ–°å¢</button>
                </div>
            </form>
        </div>
    </div>

    <div v-show="showExpenseModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end justify-center">
        <div class="bg-white w-full max-w-md p-6 rounded-t-3xl shadow-2xl">
            <h3 class="text-2xl font-bold text-deep-sea-blue mb-4">æ–°å¢èŠ±è²»</h3>
            <form @submit.prevent="addExpense" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">åç¨±</label>
                    <input type="text" v-model="newExpense.name" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div class="flex space-x-3">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700">é¡åˆ¥</label>
                        <select v-model="newExpense.category" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg bg-white">
                            <option value="äº¤é€š">äº¤é€š</option>
                            <option value="é£²é£Ÿ">é£²é£Ÿ</option>
                            <option value="ä½å®¿">ä½å®¿</option>
                            <option value="é–€ç¥¨">é–€ç¥¨</option>
                            <option value="è³¼ç‰©">è³¼ç‰©</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700">æ—¥æœŸ</label>
                        <select v-model="newExpense.date" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg bg-white">
                            <option v-for="date in dates" :key="date.fullDate" :value="date.fullDate">{{ date.dayOfWeek }} {{ date.dayOfMonth }} ({{ date.fullDate.substring(5) }})</option>
                        </select>
                    </div>
                </div>
                <div class="flex space-x-3">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700">é‡‘é¡ (JPY)</label>
                        <input type="number" v-model.number="newExpense.amount" required min="1" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700">ä»˜æ¬¾æ–¹å¼</label>
                        <select v-model="newExpense.paymentMethod" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg bg-white">
                            <option value="ç¾é‡‘">ç¾é‡‘</option>
                            <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">å‚™è¨» (é¸å¡«)</label>
                    <input type="text" v-model="newExpense.notes" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" @click="showExpenseModal = false" class="px-4 py-2 text-deep-sea-blue border border-deep-sea-blue rounded-lg hover:bg-soft-gray transition-colors">å–æ¶ˆ</button>
                    <button type="submit" class="px-6 py-2 bg-deep-sea-blue text-white rounded-lg hover:bg-ice-blue hover:text-deep-sea-blue transition-colors">æ–°å¢</button>
                </div>
            </form>
        </div>
    </div>

</div>

<script>
    // ------------------------------------
    // è¼”åŠ©å‡½æ•¸å’Œéœæ…‹è³‡æ–™
    // ------------------------------------

    const JPY_TO_TWD_RATE = 0.22; // æ¨¡æ“¬åŒ¯ç‡

    // é¡åˆ¥è¨­å®š
    const categorySettings = {
        'æ™¯é»': { color: '#A5D6A7', icon: 'fa-solid fa-map-pin', label: 'æ™¯é»' },
        'ä½å®¿': { color: '#EF9A9A', icon: 'fa-solid fa-hotel', label: 'ä½å®¿' },
        'ç¾é£Ÿ': { color: '#FFCC80', icon: 'fa-solid fa-utensils', label: 'ç¾é£Ÿ' },
        'è³¼ç‰©': { color: '#CE93D8', icon: 'fa-solid fa-bag-shopping', label: 'è³¼ç‰©' },
        'èˆªç­': { color: '#81D4FA', icon: 'fa-solid fa-plane', label: 'èˆªç­' },
        'å…¶ä»–': { color: '#B0BEC5', icon: 'fa-solid fa-ellipsis', label: 'å…¶ä»–' },
        'äº¤é€š': { color: '#81D4FA', icon: 'fa-solid fa-bus', label: 'äº¤é€š' }, // èŠ±è²»å°ˆç”¨
        'é–€ç¥¨': { color: '#A5D6A7', icon: 'fa-solid fa-ticket', label: 'é–€ç¥¨' } // èŠ±è²»å°ˆç”¨
    };
    
    // å¤©æ°£åœ–ç¤ºæ¨¡æ“¬ (ç°¡åŒ–)
    const weatherIcons = {
        'sun': 'fa-solid fa-sun',
        'cloud': 'fa-solid fa-cloud',
        'rain': 'fa-solid fa-cloud-showers-heavy',
        'snow': 'fa-solid fa-snowflake'
    };
    
    // äº¤é€šåœ–ç¤ºæ¨¡æ“¬
    const transportIcons = {
        'walk': 'fa-solid fa-person-walking',
        'car': 'fa-solid fa-car-side',
        'bus': 'fa-solid fa-train-subway'
    };

    // ç”¢ç”Ÿæ—¥æœŸåˆ—è¡¨
    const generateDates = () => {
        const startDate = new Date('2025/12/24');
        const endDate = new Date('2026/01/03');
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const datesArray = [];
        
        for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
            const dateStr = d.toISOString().split('T')[0];
            datesArray.push({
                fullDate: dateStr,
                dayOfWeek: days[d.getDay()],
                dayOfMonth: d.getDate(),
                itineraryId: datesArray.length + 1 // ç”¨ä¾†å°æ‡‰è¡Œç¨‹è³‡æ–™
            });
        }
        return datesArray;
    };
    
    // æ ¼å¼åŒ–æ•¸å­— (åƒåˆ†ä½)
    const formatNumber = (num) => {
        if (num === null || num === undefined) return '';
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    };


    // ------------------------------------
    // éœæ…‹è³‡æ–™ (æ ¹æ“šæ‚¨çš„éœ€æ±‚æ•´ç†)
    // ------------------------------------
    
    const dates = generateDates();
    
    // è¡Œç¨‹è³‡æ–™çµæ§‹ (ç°¡åŒ–ï¼Œå¯¦éš›æ‡‰ç”¨éœ€å¾ API æˆ–æœ¬åœ°å„²å­˜è¼‰å…¥)
    const initialItineraryData = [
        // 12/24 (ç¬¬ä¸€å¤©)
        { date: '2025-12-24', items: [
            { id: 1, name: 'å°ç£æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ (TPE) -> æ±äº¬æˆç”° (NRT)', category: 'èˆªç­', time: '09:30-13:30', flightNumber: 'CI0100', departureTime: '09:30', arrivalTime: '13:30', ticket: null, notes: 'è¯èˆªï¼Œé£›è¡Œæ™‚é–“ç´„4å°æ™‚', address: 'æ±äº¬æˆç”°åœ‹éš›æ©Ÿå ´', transport: { type: 'plane', time: '4h 0m' } },
            { id: 2, name: 'ç›¸éµFRESA INN æ±äº¬éŒ¦ç³¸ç”º', category: 'ä½å®¿', time: '15:00', ticket: null, notes: 'è¾¦ç†å…¥ä½', address: 'æ—¥æœ¬ã€’130-0022 Tokyo, Sumida City, Kotobashi, 2 Chomeâˆ’18âˆ’7', transport: { type: 'bus', time: '1h 30m' } },
            { id: 3, name: 'é«˜æœ¨ç¥ç¤¾â›©ï¸', category: 'æ™¯é»', time: '15:30-17:30', ticket: 0, notes: 'çµç·£ç¥ç¤¾ã€å¿—æ»¿è‰é¤…ã€å‰å‚™å­å±‹', address: 'ã€’130-0022 Tokyo, Sumida City, Tachibana, 3 Chomeâˆ’2âˆ’1', transport: { type: 'walk', time: '20m' } },
            { id: 4, name: 'æ™´ç©ºå¡”', category: 'æ™¯é»', time: 'æ™šä¸Š', ticket: null, notes: 'æ•˜æ•˜è‹‘(ç¢ºèªè¨‚ä½)ã€è–èª•å¸‚é›†ã€å¯¶å¯å¤¢ä¸­å¿ƒ', address: 'ã€’131-0045 Tokyo, Sumida City, Oshiage, 1 Chomeâˆ’1âˆ’2', transport: { type: 'bus', time: '15m' } }
        ]},
        // 12/25 (ç¬¬äºŒå¤©)
        { date: '2025-12-25', items: [
            { id: 5, name: 'ä¸Šé‡å…¬åœ’ (ä¸Šé‡ä¹‹æ£®ã€å¤§ä½›ã€æ±ç…§å®®)', category: 'æ™¯é»', time: 'å…¨æ—¥', ticket: 0, notes: 'ä¸å¿æ± è¾¯å¤©å ‚ã€èŠ±åœ’ç¨»è·ç¥ç¤¾â›©ï¸ã€safnÂ° ã‚µãƒ•ãƒ³', address: 'ã€’110-0007 Tokyo, Taito City, Uenokoen, 5âˆ’20', transport: { type: 'bus', time: '30m' } },
            { id: 6, name: 'è°·ä¸­éŠ€åº§å•†åº—è¡—', category: 'è³¼ç‰©', time: 'ä¸‹åˆ', ticket: null, notes: 'å’Œæ —ã‚„(é™å®šç”œé»)ã€å¤•é™½éšæ¢¯', address: 'ã€’110-0001 Tokyo, Taito City, Yanaka, 3 Chomeâˆ’13âˆ’1', transport: { type: 'train', time: '15m' } },
            { id: 7, name: 'ä»£ä»£æœ¨è–èª•å¸‚é›† / å…­æœ¬æœ¨', category: 'æ™¯é»', time: 'æ™šä¸Š', ticket: null, notes: 'å…¥é¹¿ToKyoæ‹‰éºµğŸœã€å…­æœ¬æœ¨Hillsè§€æ™¯å°', address: 'Roppongi Hills, 6 Chome-10-1 Roppongi, Minato City, Tokyo 106-6108', transport: { type: 'train', time: '40m' } }
        ]},
        // 12/26 (ç¬¬ä¸‰å¤©)
        { date: '2025-12-26', items: [
            { id: 8, name: 'é¶´å²¡å…«å¹¡å®® (éŒå€‰)', category: 'æ™¯é»', time: 'ä¸Šåˆ', ticket: 0, notes: 'æ–°å®¿æ­JRæ¹˜å—æ–°å®¿ç·šè‡³éŒå€‰', address: '2-1-31 Yukinoshita, Kamakura, Kanagawa 248-8588', transport: { type: 'train', time: '1h 30m' } },
            { id: 9, name: 'éŒå€‰å°ç”ºé€š', category: 'ç¾é£Ÿ', time: 'åˆé¤', ticket: null, notes: 'ç‰›å…µè¡›ã€Giraffaå’–å“©éºµåŒ…ã€Long track Foods', address: '2 Chome Komachi, Kamakura, Kanagawa 248-0006', transport: { type: 'walk', time: '10m' } },
            { id: 10, name: 'éŒ¢æ´—å¼è²¡å¤©å®‡è³€ç¦ç¥ç¤¾â›©ï¸', category: 'æ™¯é»', time: 'ä¸‹åˆ', ticket: 0, notes: 'æ´—éŒ¢ç¥ç¤¾', address: '2 Chome-25-16 Zeniarai, Kamakura, Kanagawa 248-0016', transport: { type: 'walk', time: '20m' } },
            { id: 11, name: 'æ±Ÿä¹‹å³¶', category: 'æ™¯é»', time: 'å‚æ™š', ticket: null, notes: 'ä¸ƒé‡Œæ¿±çœ‹æ—¥è½ã€KAMOKOTO Kitchen', address: '1-4-10 Enoshima, Fujisawa, Kanagawa 251-0036', transport: { type: 'train', time: '30m' } }
        ]},
        // 12/27 (ç¬¬å››å¤©)
        { date: '2025-12-27', items: [
            { id: 12, name: 'æ·ºè‰ä»ŠåŠ (å£½å–œç‡’)', category: 'ç¾é£Ÿ', time: '10:30-12:00', ticket: null, notes: 'åˆé–“å¥—é¤ $1500æ—¥å¹£ï¼Œå»ºè­°æ—©æ’éšŠ', address: '1 Chome-19-7 Nishiasakusa, Taito City, Tokyo 111-0035', transport: { type: 'train', time: '20m' } },
            { id: 13, name: 'é›·é–€ & æ·ºè‰å¯º', category: 'æ™¯é»', time: '12:00-13:00', ticket: 0, notes: 'ä¸‰éº—é·—åº—ã€å½±å‘å ‚ å¤§é»‘å¤©å¾¡å®ˆ', address: '2 Chome-3-1 Asakusa, Taito City, Tokyo 111-0032', transport: { type: 'walk', time: '5m' } },
            { id: 14, name: 'åˆç¾½æ©‹é“å…·è¡—', category: 'è³¼ç‰©', time: '13:00-14:00', ticket: null, notes: '*æ´‹è“å­ãƒ¬ãƒ¢ãƒ³ãƒ‘ã‚¤(æª¸æª¬æ´¾)', address: '3 Chome-18-2 Matsugaya, Taito City, Tokyo 111-0036', transport: { type: 'walk', time: '15m' } },
            { id: 15, name: 'éŒ¦ç³¸ç”º (é˜¿çˆ¾å¡åŸºç‰¹)', category: 'è³¼ç‰©', time: '14:00-18:00', ticket: null, notes: 'é ‚æ¨“æ‹æ™´ç©ºå¡”ã€æ ¹ä¸¸èŠ±å¼å£½å¸', address: '2 Chome-2-1 Kinshi, Sumida City, Tokyo 130-0013', transport: { type: 'train', time: '10m' } },
            { id: 16, name: 'å°å ´æµ·æ¿±å…¬åœ’ (å½©è™¹ç…™ç«)', category: 'æ™¯é»', time: '19:00', ticket: 0, notes: 'æ¯é€±å…­æ”¾äº”åˆ†é˜ï¼ˆå¾…ç¢ºèªæ˜¯å¦ç‚ºé€±å…­ï¼‰', address: '1 Chome-4 Daiba, Minato City, Tokyo 135-0091', transport: { type: 'train', time: '40m' } }
        ]},
        // 12/28 (ç¬¬äº”å¤©)
        { date: '2025-12-28', items: [
            { id: 17, name: 'äººå½¢ç”º unison taylor (æ³•å¼åå¸)', category: 'ç¾é£Ÿ', time: 'æ—©é¤', ticket: null, notes: 'è¶…å¥½åƒæ³•å¼åå¸', address: '2 Chome-21-4 Nihonbashiningyocho, Chuo City, Tokyo 103-0013', transport: { type: 'train', time: '20m' } },
            { id: 18, name: 'éº»å¸ƒå° teamlab', category: 'æ™¯é»', time: '11:30-14:30', ticket: 0, notes: 'å·²é è¨‚ 11:30', address: '1-2-4 Azabudai, Minato City, Tokyo 106-0041', transport: { type: 'train', time: '35m' } },
            { id: 19, name: 'æ¾€è°· parco & æ¥µå‘³å±‹', category: 'è³¼ç‰©', time: '15:30-18:30', ticket: null, notes: 'æ¥µå‘³å±‹b1ã€Jump shopã€ä»»å¤©å ‚ã€é’ä¹‹æ´çªŸè›‹å¡”åº—', address: '15-1 Udagawacho, Shibuya City, Tokyo 150-0042', transport: { type: 'train', time: '25m' } },
            { id: 20, name: 'æ¾€è°·SKY', category: 'æ™¯é»', time: 'æ—¥è½/19:00', ticket: null, notes: 'å¾…é å®š 19:00å·¦å³', address: '2 Chome-24-12 Shibuya, Shibuya City, Tokyo 150-0002', transport: { type: 'walk', time: '10m' } }
        ]},
        // 12/29 (ç¬¬å…­å¤©)
        { date: '2025-12-29', items: [
            { id: 21, name: 'åŸå®¿ kiddy land & è²“è¡—', category: 'è³¼ç‰©', time: 'ä¸Šåˆ', ticket: null, notes: 'å¾å··å­é€²å»ï¼Œé€›åˆ°æ¾€è°·', address: '6 Chome-1-9 Jingumae, Shibuya City, Tokyo 150-0001', transport: { type: 'train', time: '35m' } },
            { id: 22, name: 'è¡¨åƒé“', category: 'è³¼ç‰©', time: 'ä¸‹åˆ', ticket: null, notes: 'å¯éº—é¤…åº—ã€Graniphã€Flying tiger', address: 'Omotesando, Shibuya City, Tokyo', transport: { type: 'walk', time: '10m' } },
            { id: 23, name: 'æ–°å®¿ Ramen Afro Beats', category: 'ç¾é£Ÿ', time: 'æ™šé¤', ticket: null, notes: 'é›ç™½æ¹¯æ‹‰éºµ', address: '1 Chome-23-11 Hyakunincho, Shinjuku City, Tokyo 169-0073', transport: { type: 'train', time: '20m' } }
        ]},
        // 12/30 (ç¬¬ä¸ƒå¤©)
        { date: '2025-12-30', items: [
            { id: 24, name: 'ç¯‰åœ°å¸‚å ´', category: 'ç¾é£Ÿ', time: '9:00-12:00', ticket: null, notes: 'Tonboyaçƒ¤é®ªé­šä¸²ã€ä¸¸è±é£¯ç³°ã€ç±³æœ¬å’–å•¡', address: '4 Chome-16-2 Tsukiji, Chuo City, Tokyo 104-0045', transport: { type: 'train', time: '25m' } },
            { id: 25, name: 'éŠ€åº§ é‡‘é­šå±•', category: 'æ™¯é»', time: '13:00-14:00', ticket: 0, notes: 'å·²é å®š 13:30', address: 'Chuo-ku, Ginza 5-3-1 Ginza Sony Park B4F, Tokyo 104-0061', transport: { type: 'train', time: '15m' } },
            { id: 26, name: 'éŠ€åº§ é€›è¡—', category: 'è³¼ç‰©', time: '14:00-17:00', ticket: null, notes: 'Loftã€Itoyaã€ä¸‰è¶Šã€æ¾å±‹', address: 'Ginza, Chuo City, Tokyo', transport: { type: 'walk', time: '5m' } },
            { id: 27, name: 'ç§‹è‘‰åŸ', category: 'å…¶ä»–', time: 'å‚æ™š', ticket: null, notes: 'æ”¶éŸ³æ©Ÿæœƒé¤¨ã€ç¥ç”°ç¥ç¤¾ (ITå¾¡å®ˆ)ã€æµ·è€ä¸¸æ‹‰éºµ', address: 'Akihabara, Chiyoda City, Tokyo', transport: { type: 'train', time: '20m' } },
        ]},
        // 12/31 (ç¬¬å…«å¤©)
        { date: '2025-12-31', items: [
            { id: 28, name: 'å“ˆåˆ©æ³¢ç‰¹åœ’å€', category: 'æ™¯é»', time: '13:00-17:00', ticket: 6300, notes: 'å·²é è¨‚ 13:00ï¼Œææ—©9:30åˆ°è²·å‘¨é‚Š', address: '1 Chome-1-7 Nerima, Kothumicho, Tokyo 179-0074', transport: { type: 'train', time: '1h 0m' } },
            { id: 29, name: 'è·¨å¹´å¾…å®š', category: 'å…¶ä»–', time: 'æ™šä¸Š', ticket: null, notes: 'è•éº¥éºµ', address: 'Tokyo, Japan', transport: { type: 'car', time: '30m' } },
        ]},
        // 01/01 (ç¬¬ä¹å¤©)
        { date: '2026-01-01', items: [
            { id: 30, name: 'è±ªå¾·å¯º', category: 'æ™¯é»', time: 'ä¸‹åˆ', ticket: 0, notes: 'æ‹›è²¡è²“å¯ºå»Ÿ', address: '2 Chome-24-7 Gotokuji, Setagaya City, Tokyo 154-0021', transport: { type: 'train', time: '40m' } },
            { id: 31, name: 'ä¸‰è»’èŒ¶å±‹', category: 'ç¾é£Ÿ', time: 'å‚æ™š', ticket: null, notes: 'é€›è¡—ã€æ‰¾å’–å•¡å»³', address: 'Sangenjaya, Setagaya City, Tokyo', transport: { type: 'train', time: '10m' } },
        ]},
        // 01/02 (ç¬¬åå¤©)
        { date: '2026-01-02', items: [
            { id: 32, name: 'æ± è¢‹ç™¾è²¨å…¬å¸', category: 'è³¼ç‰©', time: 'ä¸Šåˆ', ticket: null, notes: 'ç¦è¢‹ã€é€›è¡—', address: 'Ikebukuro, Toshima City, Tokyo', transport: { type: 'train', time: '40m' } },
            { id: 33, name: 'æ±äº¬ å¤šæ‘©å·ç¥ç¤¾', category: 'æ™¯é»', time: 'ä¸‹åˆ', ticket: 0, notes: 'å“¥å‰æ‹‰ç¥ç¤¾', address: '3 Chome-5-18 Tamagawa, Ota City, Tokyo 146-0095', transport: { type: 'train', time: '1h 0m' } },
        ]},
        // 01/03 (ç¬¬åä¸€å¤©)
        { date: '2026-01-03', items: [
            { id: 34, name: 'åƒæ—©é¤ã€é€€æˆ¿', category: 'ä½å®¿', time: 'ä¸Šåˆ', ticket: null, notes: 'æ•´ç†è¡Œæ', address: 'æ—¥æœ¬ã€’130-0022 Tokyo, Sumida City, Kotobashi, 2 Chomeâˆ’18âˆ’7', transport: { type: 'walk', time: '5m' } },
            { id: 35, name: 'æ±äº¬æˆç”°åœ‹éš›æ©Ÿå ´ (NRT) -> å°ç£æ¡ƒåœ’ (TPE)', category: 'èˆªç­', time: '14:35-17:45', flightNumber: 'CI0101', departureTime: '14:35', arrivalTime: '17:45', ticket: null, notes: 'è¯èˆª', address: 'æ±äº¬æˆç”°åœ‹éš›æ©Ÿå ´', transport: { type: 'bus', time: '1h 30m' } }
        ]}
    ];


    // ------------------------------------
    // Vue æ‡‰ç”¨ç¨‹å¼
    // ------------------------------------

    const { createApp, ref, computed, onMounted } = Vue;

    createApp({
        setup() {
            // æ ¸å¿ƒç‹€æ…‹
            const currentTab = ref('itinerary');
            const selectedDateIndex = ref(0); // é è¨­ç¬¬ä¸€å¤©
            
            // è³‡æ–™
            const itineraryData = ref(initialItineraryData);
            const shoppingList = ref([
                { name: 'AFURI é˜¿å¤«åˆ©æ‹‰éºµ', notes: 'å¿…é»å‰ç‡’è‚‰é£¯', imageUrl: '', bought: false },
                { name: 'Harbs è›‹ç³•', notes: 'é«˜ç”°é¦¬å ´ç«™ Cafe in the house ææ‹‰ç±³è˜‡ã€å¸ƒä¸', imageUrl: '', bought: false },
                { name: 'æ±äº¬ç‰›å¥¶èµ·å¸å·¥æˆ¿', notes: 'æ©Ÿå ´å¿…è²·', imageUrl: '', bought: false },
                { name: 'ITæƒ…å ±å®‰å…¨å¾¡å®ˆ', notes: 'ç¥ç”°ç¥ç¤¾', imageUrl: '', bought: false },
            ]);
            const expenses = ref([
                { name: 'æ©Ÿç¥¨ (TPE-NRTå¾€è¿”)', category: 'èˆªç­', date: '2025-12-24', amount: 30000, paymentMethod: 'ä¿¡ç”¨å¡', notes: 'å…©äººä»½' },
                { name: 'ä½å®¿ (9æ™š)', category: 'ä½å®¿', date: '2025-12-24', amount: 50000, paymentMethod: 'ä¿¡ç”¨å¡', notes: 'ç›¸éµFRESA INN' },
                { name: 'æ•˜æ•˜è‹‘åˆé¤', category: 'é£²é£Ÿ', date: '2025-12-24', amount: 8000, paymentMethod: 'ç¾é‡‘', notes: 'æ™´ç©ºå¡”åº—' },
            ]);

            // åŒ¯ç‡æ›ç®—ç‹€æ…‹
            const currencyInput = ref(10000);
            const currencyResult = ref(0);

            // Modal ç‹€æ…‹
            const showShoppingModal = ref(false);
            const showExpenseModal = ref(false);
            const showItineraryModal = ref(false);
            const isEditMode = ref(false);
            let editingIndex = -1; // ç”¨ä¾†è¨˜éŒ„æ­£åœ¨ç·¨è¼¯å“ªå€‹è¡Œç¨‹
            
            // æ–°å¢/ç·¨è¼¯è¡¨å–®è³‡æ–™
            const newShoppingItem = ref({ name: '', notes: '', imageUrl: '', bought: false });
            const newExpense = ref({ name: '', category: 'é£²é£Ÿ', date: dates[0].fullDate, amount: null, paymentMethod: 'ç¾é‡‘', notes: '' });
            const newItinerary = ref({ id: null, name: '', category: 'æ™¯é»', time: '', ticket: null, notes: '', address: '', flightNumber: '', departureTime: '', arrivalTime: '', transport: { type: 'walk', time: '0m' } });

            // éœæ…‹/æ¨¡æ“¬è³‡è¨Š
            const flights = ref([
                { type: 'å»', originAirport: 'TPE', destinationAirport: 'NRT', departureTime: '09:30', arrivalTime: '13:30', duration: '4h 0m', flightNumber: 'CI0100' },
                { type: 'å›', originAirport: 'NRT', destinationAirport: 'TPE', departureTime: '14:35', arrivalTime: '17:45', duration: '3h 10m', flightNumber: 'CI0101' }
            ]);
            const hotels = ref({
                name: 'ç›¸éµFRESA INN æ±äº¬éŒ¦ç³¸ç”º',
                phone: '+81 3-5669-2031',
                address: 'æ—¥æœ¬ã€’130-0022 Tokyo, Sumida City, Kotobashi, 2 Chomeâˆ’18âˆ’7'
            });
            const weatherData = ref({ // æ¨¡æ“¬å–®æ—¥å¤©æ°£
                temp: 2,
                feelsLike: -1,
                icon: 'snow',
                description: 'å¤šé›²æ™‚é›ª'
            });

            // ------------------------------------
            // Computed å±¬æ€§
            // ------------------------------------

            // ç²å–ç•¶å‰é¸å®šæ—¥æœŸçš„è¡Œç¨‹
            const currentItinerary = computed(() => {
                const dateData = itineraryData.value[selectedDateIndex.value];
                return dateData ? dateData.items : [];
            });
            
            // ç¸½èŠ±è²»è¨ˆç®—
            const totalExpensesJPY = computed(() => {
                return expenses.value.reduce((sum, expense) => sum + expense.amount, 0);
            });
            const totalExpensesTWD = computed(() => {
                return Math.round(totalExpensesJPY.value * JPY_TO_TWD_RATE);
            });


            // ------------------------------------
            // æ–¹æ³• (Methods)
            // ------------------------------------

            // --- è¼”åŠ©æ–¹æ³• ---
            const getCategoryColor = (category) => categorySettings[category]?.color || '#B0BEC5';
            const getCategoryIcon = (category) => categorySettings[category]?.icon || 'fa-solid fa-question';
            const getCategoryLabel = (category) => categorySettings[category]?.label || 'å…¶ä»–';
            const getWeatherIcon = (icon) => weatherIcons[icon] || 'fa-solid fa-question';
            const getWeatherDescription = (icon) => {
                 if (icon === 'sun') return 'æ™´æœ—';
                 if (icon === 'cloud') return 'å¤šé›²';
                 if (icon === 'rain') return 'ä¸‹é›¨';
                 if (icon === 'snow') return 'ä¸‹é›ª';
                 return 'æœªçŸ¥';
            };
            const getTransportIcon = (type) => transportIcons[type] || 'fa-solid fa-route';
            
            // --- åŒ¯ç‡/å¤©æ°£ ---
            const calculateCurrency = () => {
                currencyResult.value = currencyInput.value * JPY_TO_TWD_RATE;
            };
            
            // --- æ–°å¢/ç·¨è¼¯è§¸ç™¼ ---
            const resetForms = () => {
                newShoppingItem.value = { name: '', notes: '', imageUrl: '', bought: false };
                newExpense.value = { name: '', category: 'é£²é£Ÿ', date: dates[selectedDateIndex.value].fullDate, amount: null, paymentMethod: 'ç¾é‡‘', notes: '' };
                newItinerary.value = { id: null, name: '', category: 'æ™¯é»', time: '', ticket: null, notes: '', address: '', flightNumber: '', departureTime: '', arrivalTime: '', transport: { type: 'walk', time: '0m' } };
                isEditMode.value = false;
                editingIndex = -1;
            };

            const handleAddClick = () => {
                resetForms();
                if (currentTab.value === 'itinerary') {
                    showItineraryModal.value = true;
                    // å¦‚æœæ˜¯ç¬¬ä¸€å¤©çš„ç¬¬ä¸€å€‹è¡Œç¨‹ï¼Œé è¨­é¡åˆ¥ç‚ºèˆªç­
                    if (selectedDateIndex.value === 0 && currentItinerary.value.length === 0) {
                        newItinerary.value.category = 'èˆªç­';
                    } else {
                        newItinerary.value.category = 'æ™¯é»';
                    }
                } else if (currentTab.value === 'shopping') {
                    showShoppingModal.value = true;
                } else if (currentTab.value === 'expenses') {
                    showExpenseModal.value = true;
                }
            };
            
            // --- è³¼ç‰©æ¸…å–®æ“ä½œ ---
            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    // ç‚ºäº†å–®é  HTML é‹ä½œï¼Œæˆ‘å€‘å°‡æª”æ¡ˆè½‰ç‚º Base64 (ä½†çœŸå¯¦åœ–ç‰‡å¾ˆè€—è³‡æºï¼Œå¯¦éš›æ‡‰ç”¨æœƒä¸Šå‚³åˆ°ä¼ºæœå™¨)
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        newShoppingItem.value.imageUrl = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            const addShoppingItem = () => {
                shoppingList.value.push({ ...newShoppingItem.value });
                shoppingList.value.sort((a, b) => a.bought - b.bought); // æœªè³¼åœ¨å‰
                showShoppingModal.value = false;
                resetForms();
            };

            const removeShoppingItem = (index) => {
                if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è³¼ç‰©é …ç›®å—ï¼Ÿ')) {
                    shoppingList.value.splice(index, 1);
                }
            };
            
            // --- èŠ±è²»æ“ä½œ ---
            const addExpense = () => {
                if (!newExpense.value.amount || newExpense.value.amount <= 0) return alert('è«‹è¼¸å…¥æœ‰æ•ˆé‡‘é¡');
                
                expenses.value.push({ ...newExpense.value });
                
                // æ’åº (æœ€æ–°åˆ°æœ€èˆŠ)
                expenses.value.sort((a, b) => new Date(b.date) - new Date(a.date));
                showExpenseModal.value = false;
                resetForms();
            };

            const removeExpense = (index) => {
                if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ç­†èŠ±è²»ç´€éŒ„å—ï¼Ÿ')) {
                    expenses.value.splice(index, 1);
                }
            };

            // --- è¡Œç¨‹æ“ä½œ ---
            const editItem = (type, index) => {
                if (type === 'itinerary') {
                    const item = currentItinerary.value[index];
                    newItinerary.value = { ...item };
                    isEditMode.value = true;
                    editingIndex = index;
                    showItineraryModal.value = true;
                }
            };

            const saveItineraryItem = () => {
                if (isEditMode.value) {
                    // ç·¨è¼¯æ¨¡å¼ï¼šæ›¿æ›èˆŠé …ç›®
                    currentItinerary.value.splice(editingIndex, 1, { ...newItinerary.value });
                } else {
                    // æ–°å¢æ¨¡å¼ï¼šæ–°å¢é …ç›®
                    newItinerary.value.id = Date.now();
                    // æ¨¡æ“¬è¨ˆç®—èˆ‡å‰ä¸€ç«™çš„äº¤é€šæ™‚é–“ (å‡è¨­çš†ç‚ºæ­¥è¡Œ 15m)
                    if (currentItinerary.value.length > 0) {
                        newItinerary.value.transport = { type: 'walk', time: '15m' };
                    } else if (selectedDateIndex.value > 0) {
                        // æ¯æ—¥ç¬¬ä¸€å€‹è¡Œç¨‹ï¼Œèˆ‡é£¯åº—é–“äº¤é€š
                        newItinerary.value.transport = { type: 'bus', time: '30m' };
                    }
                    currentItinerary.value.push({ ...newItinerary.value });
                }
                showItineraryModal.value = false;
                resetForms();
            };

            const removeItineraryItem = () => {
                 if (confirm(`ç¢ºå®šè¦åˆªé™¤è¡Œç¨‹ "${newItinerary.value.name}" å—ï¼Ÿ`)) {
                    currentItinerary.value.splice(editingIndex, 1);
                    showItineraryModal.value = false;
                    resetForms();
                 }
            };

            const moveItinerary = (index, direction) => {
                const items = currentItinerary.value;
                const newIndex = index + direction;
                if (newIndex >= 0 && newIndex < items.length) {
                    const [removed] = items.splice(index, 1);
                    items.splice(newIndex, 0, removed);
                }
            };

            const moveItineraryUp = (index) => moveItinerary(index, -1);
            const moveItineraryDown = (index) => moveItinerary(index, 1);

            // --- Google Maps é€£çµ ---
            const openMap = (name, address) => {
                const query = encodeURIComponent(address || name);
                window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
            };

            const openMapDirections = (name, address) => {
                const destination = encodeURIComponent(address || name);
                // é è¨­å¾é£¯åº—å°èˆª (ç°¡åŒ–è™•ç†)
                const origin = encodeURIComponent(hotels.value.address);
                window.open(`https://www.google.com/maps/dir/?api=1&destination=${destination}&origin=${origin}`, '_blank');
            };


            // è¼‰å…¥æ™‚åŸ·è¡Œ
            onMounted(() => {
                calculateCurrency();
                // åˆå§‹è¼‰å…¥æ™‚å°‡ expense æ’åº (æœ€æ–°åˆ°æœ€èˆŠ)
                expenses.value.sort((a, b) => new Date(b.date) - new Date(a.date));
            });

            return {
                currentTab, dates, selectedDateIndex, itineraryData, currentItinerary,
                flights, hotels, shoppingList, expenses, totalExpensesJPY, totalExpensesTWD,
                weatherData, currencyInput, currencyResult, calculateCurrency,
                getCategoryColor, getCategoryIcon, getCategoryLabel, getWeatherIcon, getTransportIcon, getWeatherDescription,
                showShoppingModal, showExpenseModal, showItineraryModal, isEditMode,
                newShoppingItem, newExpense, newItinerary,
                handleAddClick, handleImageUpload, addShoppingItem, removeShoppingItem,
                addExpense, removeExpense, editItem, saveItineraryItem,
                removeItineraryItem, 
                moveItineraryUp, moveItineraryDown, 
                openMap, openMapDirections, formatNumber
            };
        }
    }).mount('#app');
</script>
</body>
</html>